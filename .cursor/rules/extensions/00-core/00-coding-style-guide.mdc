---
alwaysApply: ${cursor.file.path.includes("layer/") || cursor.file.path.includes("config/") || cursor.file.path.endsWith(".yaml") || cursor.file.path.endsWith(".sh")}
---

# ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ 00: Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¿Ð¾ ÑÑ‚Ð¸Ð»ÑŽ ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ð¹ rpi-image-gen

## ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°
ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ð¾Ð±Ñ‰Ð¸Ð¹ ÐºÐ¾Ð½ÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð½Ñ‹Ð¹ ÑÑ‚Ð¸Ð»ÑŒ ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð´Ð»Ñ Ð²ÑÐµÑ… Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ð¹ rpi-image-gen, Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°Ñ ÐµÐ´Ð¸Ð½Ð¾Ð¾Ð±Ñ€Ð°Ð·Ð¸Ðµ, Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ Ð¸ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ ÐºÐ¾Ð´Ð°.

## ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ ðŸ”´ ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐ«Ð•

## ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹ ÑÑ‚Ð¸Ð»Ñ

### Ð˜ÐµÑ€Ð°Ñ€Ñ…Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð¾Ð²
```yaml
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ñ‡ÐµÑ‚ÐºÐ°Ñ Ð¸ÐµÑ€Ð°Ñ€Ñ…Ð¸Ñ Ñ Ñ€Ð°Ð·Ð´ÐµÐ»Ð°Ð¼Ð¸
# ============================================================================
# Ð—ÐÐ“ÐžÐ›ÐžÐ’ÐžÐš Ð ÐÐ—Ð”Ð•Ð›Ð
# ============================================================================

# Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ñ€Ð°Ð·Ð´ÐµÐ»Ð°
# Ñ Ð¿Ð¾ÑÑÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ

# ÐšÐ¾Ð´ Ñ€Ð°Ð·Ð´ÐµÐ»Ð°...
```

### Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñ‹ Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ñ

#### ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ IGconf_*
```bash
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð¿Ñ€ÐµÑ„Ð¸ÐºÑ + Ñ€Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ + Ð¸Ð¼Ñ
IGconf_app_service_port=8080
IGconf_device_hostname=my-rpi
IGconf_security_firewall_enabled=true

# âŒ ÐÐ•ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð¿Ñ€Ð¾Ð±ÐµÐ»Ñ‹, Ð·Ð°Ð³Ð»Ð°Ð²Ð½Ñ‹Ðµ Ð±ÑƒÐºÐ²Ñ‹ Ð² Ñ€Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑÑ…
IGconf_app-Service-Port=8080
IGconf_Device_Hostname=my-rpi
```

#### Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸ Bash
```bash
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - snake_case, Ð¿Ñ€ÐµÑ„Ð¸ÐºÑ Ñ‚Ð¸Ð¿Ð°
configure_nginx_proxy() { ... }
validate_service_port() { ... }
setup_systemd_service() { ... }

# âŒ ÐÐ•ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - camelCase, Ð±ÐµÐ· Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ¾Ð²
configureNginxProxy() { ... }
portValidation() { ... }
systemdSetup() { ... }
```

#### Ð¤Ð°Ð¹Ð»Ñ‹ Ð¸ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
```bash
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - kebab-case Ð´Ð»Ñ Ð¸Ð¼ÐµÐ½ Ñ„Ð°Ð¹Ð»Ð¾Ð²
my-application-extension.yaml
hybrid-raid-layout.sh
device-optimization.conf

# âŒ ÐÐ•ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - camelCase Ð¸Ð»Ð¸ snake_case
myApplicationExtension.yaml
hybrid_raid_layout.sh
```

## Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñ‹ Bash ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°
```bash
#!/bin/bash
# ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° Ð¸ Ð°Ð²Ñ‚Ð¾Ñ€
set -euo pipefail

# Function for error handling
die() {
    echo "ERROR: $*" >&2
    exit 1
}

# ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ main()
main() {
    # Ð›Ð¾Ð³Ð¸ÐºÐ° ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°
    echo "ðŸ”§ Starting configuration..."

    # Ð¨Ð°Ð³Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
    validate_environment
    setup_components
    configure_services
    verify_configuration

    echo "âœ… Configuration completed successfully"
}

# Ð’ÑÐ¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸
validate_environment() { ... }
setup_components() { ... }
configure_services() { ... }
verify_configuration() { ... }

# ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
trap cleanup EXIT INT TERM

# Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ
main "$@"
```

### Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº
```bash
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ð°Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ
validate_service_port() {
    local port="${IGconf_app_service_port:-8080}"

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‚Ð¸Ð¿Ð°
    if ! [[ "$port" =~ ^[0-9]+$ ]]; then
        die "service_port must be numeric: $port"
    fi

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð°
    if [[ "$port" -lt 1024 ]] || [[ "$port" -gt 65535 ]]; then
        die "service_port must be between 1024 and 65535: $port"
    fi

    echo "âœ… Service port validation passed: $port"
}

# Ð’Ñ‹Ð·Ð¾Ð² Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸
validate_service_port
```

### Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ðµ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹
```bash
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ Ñ„Ð°Ð¹Ð»Ð°Ð¼Ð¸
create_config_file() {
    local file="$1"
    local content="$2"

    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¾Ð¹
    local dir
    dir=$(dirname "$file")
    mkdir -p "$dir" || die "Failed to create directory: $dir"

    # Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ Ñ Ð±ÑÐºÐ°Ð¿Ð¾Ð¼
    if [[ -f "$file" ]] && [[ ! -f "${file}.backup" ]]; then
        cp "$file" "${file}.backup" || die "Failed to create backup: $file"
    fi

    cat > "$file" << EOF || die "Failed to write config file: $file"
$content
EOF

    # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð°Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°
    chmod 644 "$file" || die "Failed to set permissions: $file"
}

# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ ÑÐµÑ€Ð²Ð¸ÑÐ°Ð¼Ð¸
manage_systemd_service() {
    local service="$1"
    local action="$2"

    case "$action" in
        enable)
            if ! systemctl is-enabled "$service" 2>/dev/null; then
                systemctl enable "$service" || die "Failed to enable service: $service"
                echo "âœ… Service enabled: $service"
            fi
            ;;
        start)
            if ! systemctl is-active "$service" 2>/dev/null; then
                systemctl start "$service" || die "Failed to start service: $service"
                echo "âœ… Service started: $service"
            fi
            ;;
        *)
            die "Unknown action: $action"
            ;;
    esac
}
```

## Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñ‹ YAML ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
```yaml
# ÐŸÐ¾Ð»Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°Ð¼
---

# ============================================================================
# ÐŸÐ•Ð Ð•ÐœÐ•ÐÐÐ«Ð• Ð¡Ð›ÐžÐ•Ð’ (Ð²Ñ‹Ð½ÐµÑÐµÐ½Ñ‹ Ð´Ð»Ñ Ð»ÑƒÑ‡ÑˆÐµÐ¹ Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼Ð¾ÑÑ‚Ð¸)
# ============================================================================

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð² ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ Ñ„Ð¾Ñ€Ð¼Ðµ (Ð±ÐµÐ· IGconf_ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ¾Ð²)
app_service:
  port: 8080
  host: localhost
  debug: false

security_hardening:
  apparmor_mode: enforce
  firewall_policy: deny
  audit_enabled: true

# ============================================================================
# ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð¯ Ð£Ð¡Ð¢Ð ÐžÐ™Ð¡Ð¢Ð’Ð Ð˜ ÐžÐ‘Ð ÐÐ—Ð
# ============================================================================

device:
  layer: pi5
  hostname: my-production-server

image:
  layer: hybrid-raid-luks
  boot_part_size: 200%
  root_part_size: 400%

# ============================================================================
# Ð¡Ð›ÐžÐ˜ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ« (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÑÑ‹Ð»ÐºÐ¸)
# ============================================================================

layer:
  base: bookworm-minbase
  security: apparmor-core
  monitoring: prometheus-stack
  app: my-application
```

### Ð¡Ñ‚Ð¸Ð»ÑŒ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÐµÐ²
```yaml
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸
# ============================================================================
# ÐŸÐ ÐžÐ”ÐÐšÐ¨Ð ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð¯ Ð”Ð›Ð¯ Ð’Ð«Ð¡ÐžÐšÐžÐÐÐ“Ð Ð£Ð–Ð•ÐÐÐžÐ“Ðž Ð¡Ð•Ð Ð’Ð•Ð Ð
# ============================================================================
#
# Ð¦ÐµÐ»ÑŒ: ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€ Ð´Ð»Ñ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹
# ÐÐ¿Ð¿Ð°Ñ€Ð°Ñ‚Ð½Ð¾Ðµ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡ÐµÐ½Ð¸Ðµ: Raspberry Pi 5 + NVMe SSD
# Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°: Debian Bookworm
#
# ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸:
# - Hybrid RAID1 + LUKS ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð»Ñ Ð½Ð°Ð´ÐµÐ¶Ð½Ð¾ÑÑ‚Ð¸
# - ÐŸÐ¾Ð»Ð½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸ (AppArmor + UFW + Fail2Ban)
# - ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
# - ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸
# ============================================================================

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
app_service:
  port: 8080          # ÐŸÐ¾Ñ€Ñ‚ Ð²ÐµÐ±-ÑÐµÑ€Ð²Ð¸ÑÐ° (1024-65535)
  host: 0.0.0.0       # Ð¡Ð»ÑƒÑˆÐ°Ñ‚ÑŒ Ð½Ð° Ð²ÑÐµÑ… Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°Ñ…
  debug: false        # ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð»Ð°Ð´ÐºÑƒ Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ
  workers: 4          # ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ worker Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð²

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸
security_hardening:
  apparmor_mode: enforce     # Ð¡Ñ‚Ñ€Ð¾Ð³Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ AppArmor
  firewall_policy: deny      # ÐŸÐ¾Ð»Ð¸Ñ‚Ð¸ÐºÐ° Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ - Ð·Ð°Ð¿Ñ€ÐµÑ‚Ð¸Ñ‚ÑŒ
  audit_enabled: true        # Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð°ÑƒÐ´Ð¸Ñ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
  fail2ban_maxretry: 3       # ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ Ð¿Ð¾Ð¿Ñ‹Ñ‚Ð¾Ðº Ð¿ÐµÑ€ÐµÐ´ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ¾Ð¹

# âŒ ÐÐ•ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸
app_service:
  port: 8080          # port
  host: 0.0.0.0       # host
```

## Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñ‹ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ»Ð¾ÐµÐ²

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° X-Env Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ…
```yaml
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð¿Ð¾Ð»Ð½Ð°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
# METABEGIN
# X-Env-Layer-Name: my-application
# X-Env-Layer-Category: extension
# X-Env-Layer-Description: ÐŸÐ¾Ð»Ð½Ð¾Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð¾Ð¼
# X-Env-Layer-Version: 1.2.0
# X-Env-Layer-Requires: essential,net-misc,security-basic
# X-Env-VarPrefix: app
#
# X-Env-Var-service_port: 8080
# X-Env-Var-service_port-Description: ÐŸÐ¾Ñ€Ñ‚ Ð´Ð»Ñ HTTP ÑÐµÑ€Ð²Ð¸ÑÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
# X-Env-Var-service_port-Required: false
# X-Env-Var-service_port-Valid: int:1024-65535
#
# X-Env-Var-enable_ssl: false
# X-Env-Var-enable_ssl-Description: Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ HTTPS Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð¼
# X-Env-Var-enable_ssl-Required: false
# X-Env-Var-enable_ssl-Valid: true,false
# METAEND
```

### Ð¡Ð¾Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ñ Ð¿Ð¾ Ð²ÐµÑ€ÑÐ¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÑŽ
```yaml
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - ÑÐµÐ¼Ð°Ð½Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð²ÐµÑ€ÑÐ¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
X-Env-Layer-Version: 1.2.3

# Ð“Ð´Ðµ:
# 1 - MAJOR: breaking changes (Ð½ÐµÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ)
# 2 - MINOR: Ð½Ð¾Ð²Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ (Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ)
# 3 - PATCH: Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð±Ð°Ð³Ð¾Ð² (Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ)

# ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:
# 1.0.0 - Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ñ€ÐµÐ»Ð¸Ð·
# 1.1.0 - Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° Ð½Ð¾Ð²Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ
# 1.1.1 - Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½ Ð±Ð°Ð³
# 2.0.0 - breaking changes Ð² API
```

## Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñ‹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸

### Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
```bash
#!/bin/bash
# configure_database_connection()
# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… PostgreSQL
#
# ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
#   $1 - Ñ‚Ð¸Ð¿ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… (postgresql, mysql, sqlite)
#   $2 - ÑÑ‚Ñ€Ð¾ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
#
# Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚:
#   0 - ÑƒÑÐ¿ÐµÑ…
#   1 - Ð¾ÑˆÐ¸Ð±ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
#
# ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ:
#   configure_database_connection "postgresql" "host=localhost dbname=myapp"
#
# Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸:
#   - postgresql-client Ð¸Ð»Ð¸ mysql-client
#   - curl Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
#
# ÐÐ²Ñ‚Ð¾Ñ€: ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
# Ð’ÐµÑ€ÑÐ¸Ñ: 1.0.0
configure_database_connection() {
    local db_type="$1"
    local connection_string="$2"

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
    if [[ -z "$db_type" ]] || [[ -z "$connection_string" ]]; then
        echo "ERROR: db_type and connection_string are required" >&2
        return 1
    fi

    # Ð›Ð¾Ð³Ð¸ÐºÐ° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸...
}
```

### Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ…ÑƒÐºÐ¾Ð²
```yaml
mmdebstrap:
  customize-hooks:
    - |
      #!/bin/bash
      # Hook: Application Deployment and Configuration
      #
      # ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: ÐŸÐ¾Ð»Ð½Ð°Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
      # Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð½Ð° ÑÑ‚Ð°Ð¿Ðµ customize Ð² mmdebstrap
      #
      # ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ:
      #   IGconf_app_service_port - Ð¿Ð¾Ñ€Ñ‚ ÑÐµÑ€Ð²Ð¸ÑÐ° (default: 8080)
      #   IGconf_app_database_url - URL Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… (required)
      #
      # Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚:
      #   - Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ app_user
      #   - Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Python
      #   - SystemD ÑÐµÑ€Ð²Ð¸Ñ
      #   - Nginx ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ
      #
      # ÐÐ²Ñ‚Ð¾Ñ€: ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹
      # Ð’ÐµÑ€ÑÐ¸Ñ: 1.0.0
      # Ð”Ð°Ñ‚Ð°: 2024-01-15

      set -euo pipefail
      # ... Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ…ÑƒÐºÐ° ...
```

## Ð›ÑƒÑ‡ÑˆÐ¸Ðµ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ¸

### ÐžÑ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð´Ð°
```bash
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸
main() {
    validate_inputs
    setup_environment
    install_dependencies
    configure_services
    enable_services
    verify_deployment
}

validate_inputs() {
    # Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð²ÑÐµÑ… Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
}

setup_environment() {
    # ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
}

install_dependencies() {
    # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
}

configure_services() {
    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
}

enable_services() {
    # Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¸ Ð·Ð°Ð¿ÑƒÑÐº
}

verify_deployment() {
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ
}
```

### ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº
```bash
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - graceful degradation
configure_optional_feature() {
    local feature_name="$1"

    if command -v required_command >/dev/null 2>&1; then
        echo "ðŸ”§ Configuring $feature_name..."
        setup_feature || echo "âš ï¸  Failed to configure $feature_name, continuing..."
    else
        echo "âš ï¸  $feature_name not available, skipping..."
    fi
}

# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…
validate_critical_component() {
    local component="$1"

    if ! check_component "$component"; then
        cat >&2 << EOF
ERROR: Critical component '$component' failed validation!

Possible causes:
- Missing dependencies
- Incorrect configuration
- Permission issues

Please check:
1. System requirements documentation
2. Configuration variables
3. System logs: journalctl -u $component

For help, see: https://rpi-image-gen.readthedocs.io/components/$component
EOF
        exit 1
    fi
}
```

### ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ
```bash
# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ†Ð¸ÐºÐ»Ð¾Ð²
process_items() {
    local items_file="$1"

    # Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ progress indicator
    local total_count
    total_count=$(wc -l < "$items_file")
    local current=0

    while IFS= read -r item; do
        ((current++))
        echo "[$current/$total_count] Processing: $item"

        # ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐµÑÐ»Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾
        process_item "$item" &
        wait_for_jobs 4  # ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ 4 Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡Ð¸
    done < "$items_file"
}

wait_for_jobs() {
    local max_jobs="$1"
    while [[ $(jobs -r | wc -l) -ge $max_jobs ]]; do
        sleep 0.1
    done
}
```

## Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°

### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð¸Ð»Ñ
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Bash ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²
check_bash_style() {
    local script_file="$1"

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ set -euo pipefail
    if ! head -5 "$script_file" | grep -q "set -euo pipefail"; then
        echo "ERROR: Missing 'set -euo pipefail' in $script_file"
        return 1
    fi

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ die Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸
    if ! grep -q "^die()" "$script_file"; then
        echo "ERROR: Missing die() function in $script_file"
        return 1
    fi

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
    if grep -q "^[a-zA-Z_][a-zA-Z0-9_]*()" "$script_file"; then
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹
        echo "INFO: Functions found, checking documentation..."
    fi
}

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° YAML ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹
check_yaml_style() {
    local config_file="$1"

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹
    if ! grep -q "^layer:" "$config_file"; then
        echo "ERROR: Missing layer section in $config_file"
        return 1
    fi

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÐµÐ²
    if ! grep -q "^#" "$config_file"; then
        echo "WARNING: No comments found in $config_file"
    fi
}
```

### ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÐºÐ¾Ð´Ð°
```bash
# ÐÐ½Ð°Ð»Ð¸Ð· ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
analyze_complexity() {
    local script_file="$1"

    echo "=== Code Complexity Analysis ==="

    # ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ ÑÑ‚Ñ€Ð¾Ðº ÐºÐ¾Ð´Ð°
    local lines_count
    lines_count=$(wc -l < "$script_file")
    echo "Total lines: $lines_count"

    # ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
    local functions_count
    functions_count=$(grep -c "^[a-zA-Z_][a-zA-Z0-9_]*()" "$script_file")
    echo "Functions: $functions_count"

    # Ð¡Ñ€ÐµÐ´Ð½ÑÑ Ð´Ð»Ð¸Ð½Ð° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸
    if [[ $functions_count -gt 0 ]]; then
        local avg_function_length=$(( lines_count / functions_count ))
        echo "Average function length: $avg_function_length lines"

        # ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ Ð¾ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð´Ð»Ð¸Ð½Ð½Ñ‹Ñ… Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÑ…
        if [[ $avg_function_length -gt 50 ]]; then
            echo "WARNING: Functions are too long, consider splitting"
        fi
    fi
}
```

---

## ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ ÑÐ¾Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° ðŸ”´ ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐ«Ð•

### ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹
- [ ] Ð’ÑÐµ Ð½Ð¾Ð²Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ ÑÐ»ÐµÐ´ÑƒÑŽÑ‚ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ð¾Ð¼Ñƒ ÑÑ‚Ð¸Ð»ÑŽ
- [ ] Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð°Ð¼
- [ ] ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð¸Ð»Ñ Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð° Ð² CI/CD
- [ ] ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð° ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð°Ð¼ ÑÑ‚Ð¸Ð»Ñ

### ÐšÐ°Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸
- [ ] 100% Ð½Ð¾Ð²Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ ÑÑ‚Ð¸Ð»ÑŽ
- [ ] Ð¡Ñ€ÐµÐ´Ð½ÑÑ Ð´Ð»Ð¸Ð½Ð° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ Ð½Ðµ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°ÐµÑ‚ 30 ÑÑ‚Ñ€Ð¾Ðº
- [ ] Ð’ÑÐµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ Ð¸Ð¼ÐµÑŽÑ‚ set -euo pipefail
- [ ] Ð’ÑÐµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹
- [ ] Ð’ÑÐµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð¸Ð¼ÐµÑŽÑ‚ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ

### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°
- [ ] Ð›Ð¸Ð½Ñ‚Ð¸Ð½Ð³ Bash ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² (shellcheck)
- [ ] Ð›Ð¸Ð½Ñ‚Ð¸Ð½Ð³ YAML Ñ„Ð°Ð¹Ð»Ð¾Ð² (yamllint)
- [ ] ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð¸Ð»Ñ ÐºÐ¾Ð´Ð°
- [ ] ÐÐ½Ð°Ð»Ð¸Ð· ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ ÐºÐ¾Ð´Ð°

### Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº
Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÐºÐ¾Ð´Ð° Ð² rpi-image-gen Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ Ð¸ Ð»ÑƒÑ‡ÑˆÐ¸Ñ… Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ðº Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸.