---
alwaysApply: ${cursor.file.path.endsWith('.mdc') || cursor.file.path.includes("layer/") || cursor.file.path.includes("config/") || cursor.file.path.includes("image/")}
---

# –ü—Ä–∞–≤–∏–ª–æ 00: –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ —Å–≤—è–∑–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã rpi-image-gen, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–≤—è–∑–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å, –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.

## –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ üîµ –ò–ù–§–û–†–ú–ê–¶–ò–Ø
**–ß–∞—Å—Ç—å –∫–æ–º–∞–Ω–¥, –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–º –ø—Ä–∞–≤–∏–ª–µ, —è–≤–ª—è–µ—Ç—Å—è –ñ–ï–õ–ê–ï–ú–û–ô —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.** –ö–æ–º–∞–Ω–¥—ã —Ç–∏–ø–∞ `rpi-image-gen refactor --*`, `rpi-image-gen validate --cohesion`, `rpi-image-gen layer --graph-dependencies` –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞. –ü—Ä–∞–≤–∏–ª–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É –ø—Ä–∞–≤–∏–ª–∞–º–∏

### –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ—Ç –æ–±—â–µ–≥–æ –∫ —á–∞—Å—Ç–Ω–æ–º—É:

```yaml
# –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
00-core/ ‚Üí 10-development/ ‚Üí 20-specialized/ ‚Üí 30-tools/

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏
20-specialized/ ‚Üí 00-core/
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ–Ω–µ–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.

### –ü–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ö–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —á–µ—Ç–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–≤–Ω–µ–π:

```yaml
# –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞
X-Env-Transition-Interface: security-core
X-Env-Transition-Variables:
  - IGconf_security_base_mode
  - IGconf_security_audit_enabled
X-Env-Transition-Hooks:
  - security-validation
  - security-setup
```

### –°–≤—è–∑–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ IGconf_* –æ–±—Ä–∞–∑—É—é—Ç —Å–≤—è–∑–Ω—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é:

```yaml
# –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
IGconf_base_*           # 00-core —É—Ä–æ–≤–µ–Ω—å
IGconf_security_*       # 10-development —É—Ä–æ–≤–µ–Ω—å
IGconf_app_*           # 20-specialized —É—Ä–æ–≤–µ–Ω—å
IGconf_device_*        # –£—Å—Ç—Ä–æ–π—Å—Ç–≤–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
```

## –ú–µ—Ö–∞–Ω–∏–∑–º—ã –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –°–ª–æ–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:

```yaml
# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
layer: security-basic
# + —Ä—É—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –±–∞–∑–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

# –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
layer: security-advanced
layer.base: security-basic  # –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –±–∞–∑–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
# + —Ç–æ–ª—å–∫–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

### –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:

```yaml
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
IGconf_security_firewall_rules: "${IGconf_security_firewall_rules},custom-rule"
# –í–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –∑–∞–º–µ–Ω—ã

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ø–æ—Ç–µ—Ä—è –±–∞–∑–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
IGconf_security_firewall_rules: "only-custom-rule"
```

### –ö–æ–º–ø–æ–∑–∏—Ü–∏—è —Ö—É–∫–æ–≤
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –•—É–∫–∏ –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ –∑–∞–º–µ–Ω—ã:

```yaml
# –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
hooks:
  - base-security-setup
  - advanced-security-setup  # –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –Ω–µ –∑–∞–º–µ–Ω–∞
  - monitoring-integration   # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–≤—è–∑–Ω–æ—Å—Ç–∏

### –ü–∞—Ç—Ç–µ—Ä–Ω "–ë–∞–∑–æ–≤—ã–π + –†–∞—Å—à–∏—Ä–µ–Ω–∏—è"
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ö–∞–∂–¥—ã–π —Å–ª–æ–π —Å–ª–µ–¥—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—É –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:

```yaml
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–æ—è
layer-name/
‚îú‚îÄ‚îÄ layer-name-core.yaml     # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ layer-name-extended.yaml # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
‚îî‚îÄ‚îÄ layer-name-integration.yaml # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–ª–æ—è–º–∏
```

### –ü–∞—Ç—Ç–µ—Ä–Ω "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å + –†–µ–∞–ª–∏–∑–∞—Ü–∏—è"
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏:

```yaml
# –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
X-Env-Layer-Provides: firewall-interface
X-Env-Layer-Implementation: ufw-backend

# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω–∞
X-Env-Layer-Provides: firewall-interface
X-Env-Layer-Implementation: firewalld-backend
```

### –ü–∞—Ç—Ç–µ—Ä–Ω "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è + –í–∞–ª–∏–¥–∞—Ü–∏—è"
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ö–∞–∂–¥–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é:

```yaml
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
validate-hook: |
  if [ -z "${IGconf_required_variable}" ]; then
    echo "ERROR: required_variable not set" >&2
    exit 1
  fi
```

## –ü—Ä–∞–≤–∏–ª–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –°–ª–æ–∏ –∏–º–µ—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```yaml
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ: —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
X-Env-Layer-Requires: base-system, security-core

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
X-Env-Layer-Requires: base-system, security-core, monitoring, backup, logging, networking, storage
```

### –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–µ—â–µ–Ω—ã
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ó–∞–ø—Ä–µ—â–µ–Ω—ã —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏:

```yaml
# –ó–∞–ø—Ä–µ—â–µ–Ω–æ: layer-a –∑–∞–≤–∏—Å–∏—Ç –æ—Ç layer-b, layer-b –∑–∞–≤–∏—Å–∏—Ç –æ—Ç layer-a
layer-a ‚Üí layer-b ‚Üí layer-a

# –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ª–∏–Ω–µ–π–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
layer-a ‚Üí layer-b ‚Üí layer-c
```

### –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—é—Ç—Å—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

```yaml
# –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
X-Env-Layer-Version: 2.0.0
X-Env-Transition-Breaking-Changes: |
  - IGconf_old_variable –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ IGconf_new_variable
  - –¢—Ä–µ–±—É–µ—Ç—Å—è layer-new-dependency
```

## –ú–µ—Ç–æ–¥—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–≤—è–∑–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
rpi-image-gen layer --validate-dependencies config.yaml

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π
rpi-image-gen layer --check-compatibility config.yaml
```

### –ú–µ—Ç—Ä–∏–∫–∏ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞—é—Ç—Å—è –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –∫–∞—á–µ—Å—Ç–≤–∞:

```yaml
# –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
cohesion_score: 95%      # –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
dependency_depth: 3      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
interface_stability: 100% # –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ö–∞–∂–¥–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–ª–æ–µ–≤ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:

```yaml
# –ú–∞—Ç—Ä–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
test_combinations:
  - [base, security-basic]
  - [base, security-advanced]
  - [base, security-basic, monitoring]
  - [base, security-advanced, monitoring, backup]
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –í—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã:

```markdown
## –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–µ—Ä–µ—Ö–æ–¥–∞: security-core

### –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- `IGconf_security_mode`: –†–µ–∂–∏–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (enforce/audit)
- `IGconf_security_audit`: –í–∫–ª—é—á–µ–Ω–∏–µ –∞—É–¥–∏—Ç–∞ (y/n)

### –¢—Ä–µ–±—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `base-system`: –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –•—É–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞
- `security-setup`: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `security-validation`: –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

### –ì—Ä–∞–¥—É–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–≤–æ–¥—è—Ç—Å—è –ø–æ—ç—Ç–∞–ø–Ω–æ:

```yaml
# –≠—Ç–∞–ø 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
X-Env-Layer-Version: 1.1.0
# –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã

# –≠—Ç–∞–ø 2: –ü–µ—Ä–µ—Ö–æ–¥–Ω—ã–π –ø–µ—Ä–∏–æ–¥
X-Env-Layer-Version: 2.0.0-rc1
# –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ deprecated –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

# –≠—Ç–∞–ø 3: –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
X-Env-Layer-Version: 2.0.0
# –¢–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:

```yaml
# –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
interface_usage:
  IGconf_security_mode:
    used_by: 15
    deprecated: false
  IGconf_old_variable:
    used_by: 2
    deprecated: true
    replacement: IGconf_new_variable
```

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–≤—è–∑–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏:

```bash
# –ü–æ–∏—Å–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
rpi-image-gen refactor --find-duplicates layer/

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ–±—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
rpi-image-gen refactor --extract-common layer/security-*/ --output layer/security-common.yaml

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
rpi-image-gen validate --cohesion config.yaml
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
rpi-image-gen layer --graph-dependencies config.yaml --output dependencies.png

# –ê–Ω–∞–ª–∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π
rpi-image-gen layer --critical-path config.yaml
```

## –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- [ ] –í—Å–µ —Å–ª–æ–∏ —Å–ª–µ–¥—É—é—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—É "–ë–∞–∑–æ–≤—ã–π + –†–∞—Å—à–∏—Ä–µ–Ω–∏—è"
- [ ] –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –ö–∞–∂–¥–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–º–µ–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
- [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –≤ CI/CD

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- [ ] Cohesion score > 90% –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- [ ] Dependency depth ‚â§ 5 —É—Ä–æ–≤–Ω–µ–π
- [ ] Interface stability > 95%
- [ ] 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–º–ø–æ–∑–∏—Ü–∏–π
- [ ] –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–ª–æ–µ–≤

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–µ
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—è–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### –ò—Å—Ç–æ—á–Ω–∏–∫
–°–æ–∑–¥–∞–Ω–æ –∫–∞–∫ –æ—Å–Ω–æ–≤–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –∏ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∞–≤–∏–ª rpi-image-gen, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏.