---
alwaysApply: ${cursor.file.path.endsWith(".yaml") && cursor.file.path.includes("config/")}
---

# –ü—Ä–∞–≤–∏–ª–æ 09: –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ YAML

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ YAML –¥–ª—è —Å–∏—Å—Ç–µ–º—ã rpi-image-gen. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
–ö–∞–∂–¥–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º —Ç—Ä–∏ —Å–µ–∫—Ü–∏–∏:

```yaml
# –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
device:
  layer: <device_layer>

# –û–±—Ä–∞–∑ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
image:
  layer: <image_layer>
  name: <image_name>

# –ë–∞–∑–æ–≤—ã–π —Å–ª–æ–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
layer:
  base: <base_layer>
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
```yaml
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ–µ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π)
<layer_name>:
  <parameter>: <value>

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–∏
layer:
  <layer_type>: <layer_name>
```

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (test.yaml)
```yaml
device:
  layer: rpi5

image:
  layer: hybrid-raid-luks
  name: test-hybrid-raid-luks

hybrid_raid_luks:  # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ª–æ—è
  rootfs_type: ext4
  encryption_enabled: y
  key_method: file
  key_size: 512
  ssd_devices: /dev/sda,/dev/sdb
  boot_part_size: 200M
  root_part_size: 2G
  pmap: crypt
  disk_expansion_enabled: y

layer:
  base: bookworm-minbase
```

### –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (complete-system.yaml)
```yaml
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ–µ–≤ (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏)
sysctl_kernel:
  ptrace_restrict: y
  aslr_enable: y

sysctl_security:
  core_dump_restrict: y
  perf_event_paranoid: 2

# ... –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ–µ–≤

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –æ–±—Ä–∞–∑–∞
device:
  layer: rpi5
  hostname: rpi-complete-system

image:
  layer: hybrid-raid-luks
  boot_part_size: 200%
  root_part_size: 400%
  name: complete-system

# –°–ª–æ–∏ —Å–∏—Å—Ç–µ–º—ã
layer:
  base: bookworm-minbase
  build_base: sys-build-base
  sysctl_kernel: sysctl-kernel
  sysctl_security: sysctl-security
  # ... –¥—Ä—É–≥–∏–µ —Å–ª–æ–∏
```

## –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è

### –ò–º–µ–Ω–∞ —Å–µ–∫—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å snake_case –¥–ª—è –∏–º–µ–Ω —Å–µ–∫—Ü–∏–π
- –ò–∑–±–µ–≥–∞—Ç—å –¥–µ—Ñ–∏—Å–æ–≤ –≤ –∏–º–µ–Ω–∞—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –î–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–ª–æ–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å –∏–∑ `X-Env-VarPrefix`

### –ò–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- snake_case –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ë—É–ª–µ–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è: `y`/`n`
- –†–∞–∑–º–µ—Ä—ã: —Å –µ–¥–∏–Ω–∏—Ü–∞–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è (`200M`, `2G`, `100%`)

## –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—è–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

### –£—Ä–æ–≤–µ–Ω—å 1: –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
```yaml
layer:
  base: <debian_suite>-minbase
  build_base: sys-build-base
```

### –£—Ä–æ–≤–µ–Ω—å 2: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
```yaml
# –Ø–¥—Ä–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
sysctl_kernel: {ptrace_restrict: y, aslr_enable: y}
sysctl_security: {core_dump_restrict: y}
audit_core: {enable: y, buffer_size: 1024}
firewall_basic: {enable: y, default_input_policy: DROP}
```

### –£—Ä–æ–≤–µ–Ω—å 3: –°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
```yaml
# –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–ª–∏—Ç–∏–∫–∞
pam_core: {enable: y, minlen: 12}
password_policies_core: {enable: y, min_length: 12}
fail2ban_core: {enable: y, loglevel: INFO}
apparmor_core: {enable: y, mode: enforce}
```

### –£—Ä–æ–≤–µ–Ω—å 4: –ü—Ä–∏–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
```yaml
# –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Å–µ—Ä–≤–∏—Å—ã
docker: {trust_user1: n}
distrobox: {container_name: development, container_image: ubuntu:22.04}
cockpit_web: {enable: y}
```

### –£—Ä–æ–≤–µ–Ω—å 5: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
```yaml
# –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
rpi5_server_config: {disable_hdmi: y, pcie_max_speed: y}
radxa_sata_hat: {pcie_gen3: y, initramfs_sata: y}
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ —É—Ä–æ–≤–Ω—è–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
- –î–æ–±–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —É—Ä–æ–≤–Ω–µ–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø

### –ß–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å inline —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- –í—ã–Ω–æ—Å–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
- –î–æ–±–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```yaml
device: {layer: rpi5}
image: {layer: image-rpios, name: minimal}
layer: {base: bookworm-minbase}
```

### –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
```yaml
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ–µ–≤
docker: {trust_user1: n}
sysctl_kernel: {ptrace_restrict: y}

# –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
device: {layer: rpi5}
image: {layer: hybrid-raid-luks, name: full-system}
layer:
  base: bookworm-minbase
  docker: docker-debian-bookworm
  sysctl_kernel: sysctl-kernel
```

## –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- [ ] –ù–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–µ–∫—Ü–∏–π (device, image, layer)
- [ ] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (snake_case)
- [ ] –í–∞–ª–∏–¥–Ω—ã–π YAML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- [ ] –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- [ ] –õ–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
- [ ] –ß–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- [ ] –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- [ ] YAML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤–∞–ª–∏–¥–µ–Ω
- [ ] –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- [ ] –ò–º–µ–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∞–≤–∏–ª–∞–º –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
- [ ] –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º —Å–ª–æ–µ–≤

### –ò—Å—Ç–æ—á–Ω–∏–∫
–°–æ–∑–¥–∞–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π test.yaml –∏ complete-system.yaml —Å —Ü–µ–ª—å—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ rpi-image-gen.