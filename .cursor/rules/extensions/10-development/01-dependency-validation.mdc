---
alwaysApply: ${cursor.file.path.endsWith('.mdc') || cursor.file.path.includes("layer/") || cursor.file.path.includes("config/")}
---

# –ü—Ä–∞–≤–∏–ª–æ 01: –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–≤—è–∑–Ω–æ—Å—Ç–∏

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Å–ª–æ—è–º–∏, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π rpi-image-gen.

## –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ üîµ –ò–ù–§–û–†–ú–ê–¶–ò–Ø
**–ß–∞—Å—Ç—å –∫–æ–º–∞–Ω–¥ –∞–Ω–∞–ª–∏–∑–∞ –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —è–≤–ª—è–µ—Ç—Å—è –ñ–ï–õ–ê–ï–ú–û–ô —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.** –ö–æ–º–∞–Ω–¥—ã —Ç–∏–ø–∞ `rpi-image-gen analyze --cohesion`, `rpi-image-gen layer --graph`, `rpi-image-gen layer --critical-path`, `rpi-image-gen refactor --*` –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏. –ü—Ä–∞–≤–∏–ª–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞.

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ö–∞–∂–¥–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
rpi-image-gen build -c config.yaml --validate-dependencies

# –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
rpi-image-gen layer --validate config.yaml
```

**–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∞—Å–ø–µ–∫—Ç—ã:**
- –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —Ç—Ä–µ–±—É–µ–º—ã—Ö —Å–ª–æ–µ–≤
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö —Å–ª–æ–µ–≤
- –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ü–µ–ø–æ—á–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –î–µ—Ç–µ–∫—Ü–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—è–≤–ª—è–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏:

```yaml
# –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
layers:
  - security-basic
  - monitoring-core

# –ì–¥–µ security-basic —Ç—Ä–µ–±—É–µ—Ç monitoring-core
# –ê monitoring-core —Ç—Ä–µ–±—É–µ—Ç security-basic
# –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
```

**–ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏:**
```python
def detect_cycles(dependencies):
    visited = set()
    rec_stack = set()

    def dfs(node):
        visited.add(node)
        rec_stack.add(node)

        for dep in dependencies.get(node, []):
            if dep not in visited:
                if dfs(dep):
                    return True
            elif dep in rec_stack:
                return True  # –ù–∞–π–¥–µ–Ω —Ü–∏–∫–ª

        rec_stack.remove(node)
        return False

    for node in dependencies:
        if node not in visited:
            if dfs(node):
                return True
    return False
```

## –ê–Ω–∞–ª–∏–∑ –≥–ª—É–±–∏–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥–ª—É–±–∏–Ω—ã
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 5 —É—Ä–æ–≤–Ω–µ–π:

```yaml
# –ü—Ä–∏–µ–º–ª–µ–º–∞—è –≥–ª—É–±–∏–Ω–∞
layer-app ‚Üí layer-service ‚Üí layer-security ‚Üí layer-base (4 —É—Ä–æ–≤–Ω—è)

# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –≥–ª—É–±–∏–Ω–∞ (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
layer-app ‚Üí layer-ui ‚Üí layer-api ‚Üí layer-service ‚Üí layer-security ‚Üí layer-monitoring ‚Üí layer-base (7 —É—Ä–æ–≤–Ω–µ–π)
```

### –ú–µ—Ç—Ä–∏–∫–∏ –≥–ª—É–±–∏–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥–ª—É–±–∏–Ω—ã:

```yaml
# –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
dependency_metrics:
  max_depth: 5
  avg_depth: 2.8
  layers_with_depth_5+: 3
  recommended_max_depth: 4
```

## –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π

### –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –°–ª–æ–∏ —Å–ª–µ–¥—É—é—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–º—É –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é:

```yaml
# –§–æ—Ä–º–∞—Ç –≤–µ—Ä—Å–∏–∏
X-Env-Layer-Version: major.minor.patch

# –ü—Ä–∏–º–µ—Ä—ã
X-Env-Layer-Version: 1.0.0  # –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑
X-Env-Layer-Version: 1.1.0  # –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
X-Env-Layer-Version: 2.0.0  # Breaking changes
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π:

```yaml
# –ú–∞—Ç—Ä–∏—Ü–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
compatibility_matrix:
  layer-a: "1.0.0"
  layer-b: ">=1.0.0, <2.0.0"  # –°–æ–≤–º–µ—Å—Ç–∏–º —Å 1.x
  layer-c: "^1.2.0"            # –°–æ–≤–º–µ—Å—Ç–∏–º —Å 1.2.x –∏ –≤—ã—à–µ –≤ 1.x
```

## –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–ª–æ–µ–≤

### –î–µ—Ç–µ–∫—Ü–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –í—ã—è–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ IGconf_*:

```yaml
# –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
layer-a:
  IGconf_security_mode: enforce

layer-b:
  IGconf_security_mode: audit  # –ö–æ–Ω—Ñ–ª–∏–∫—Ç!

# –†–µ—à–µ–Ω–∏–µ: —è–≤–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
layer-combined:
  IGconf_security_mode: "${IGconf_security_base_mode:-enforce}"
```

### –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:

```yaml
# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
conflict_resolution:
  explicit_override: highest    # –Ø–≤–Ω–æ–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ
  layer_order: high            # –ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–µ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  version_priority: medium     # –ù–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
  dependency_depth: low        # –ì–ª—É–±–∏–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```

## –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏

### –ò–Ω–¥–µ–∫—Å —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –†–∞—Å—á–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –∫–∞—á–µ—Å—Ç–≤–∞:

```yaml
# –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞
cohesion_index = (
    (1 - cycles_penalty) * 0.3 +
    (1 - depth_penalty) * 0.25 +
    (compatibility_score) * 0.25 +
    (reuse_score) * 0.2
) * 100

# –ì–¥–µ:
# cycles_penalty = cycles_count * 0.5
# depth_penalty = max(0, max_depth - 4) * 0.1
# compatibility_score = compatible_layers / total_layers
# reuse_score = shared_variables / total_variables
```

### –û—Ç—á–µ—Ç –æ –∫–∞—á–µ—Å—Ç–≤–µ —Å–≤—è–∑–Ω–æ—Å—Ç–∏
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
rpi-image-gen analyze --cohesion config.yaml --output cohesion-report.json

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—á–µ—Ç–∞
{
  "overall_score": 87.5,
  "metrics": {
    "dependency_depth": {"max": 4, "avg": 2.3},
    "cycles_detected": 0,
    "compatibility_issues": 2,
    "reuse_efficiency": 78.5
  },
  "recommendations": [
    "–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ layer-a –∏ layer-b –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –≥–ª—É–±–∏–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π",
    "–†–∞–∑—Ä–µ—à–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π –º–µ–∂–¥—É security-core –∏ monitoring-extended"
  ]
}
```

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –≤–∏–¥–µ –≥—Ä–∞—Ñ–∞:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
rpi-image-gen layer --graph config.yaml --output dependencies.dot

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
dot -Tpng dependencies.dot -o dependencies.png

# –¢–∏–ø—ã —Å–≤—è–∑–µ–π –≤ –≥—Ä–∞—Ñ–µ:
# ‚Üí (requires): –∂–µ—Å—Ç–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
# ‚á¢ (optional): –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
# ‚á† (conflicts): –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–ª–æ–µ–≤
```

### –ê–Ω–∞–ª–∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –í—ã—è–≤–ª–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö:

```bash
# –ê–Ω–∞–ª–∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π
rpi-image-gen layer --critical-path config.yaml

# –í—ã–≤–æ–¥:
# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å: app-layer ‚Üí api-layer ‚Üí db-layer ‚Üí base-layer
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞: 4
# –£–∑–∫–∏–µ –º–µ—Å—Ç–∞: db-layer (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 8 —Å–ª–æ—è–º–∏)
```

## –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å–≤—è–∑–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏:

```bash
# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ–±—â–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
rpi-image-gen refactor --extract-common layer/security-*.yaml --output layer/security-common.yaml

# –†–∞–∑–±–∏–µ–Ω–∏–µ –≥–ª—É–±–æ–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
rpi-image-gen refactor --split-deep-dependencies config.yaml --max-depth 4

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—è–¥–∫–∞ —Å–ª–æ–µ–≤
rpi-image-gen refactor --optimize-order config.yaml
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–ª–∏—è–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Å–≤—è–∑–Ω–æ—Å—Ç—å:

```yaml
# –û—Ç—á–µ—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
change_impact:
  added_layers: ["new-security-layer"]
  removed_layers: []
  modified_interfaces: ["IGconf_security_mode"]
  cohesion_impact: -2.3  # –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É—Ö—É–¥—à–µ–Ω–∏–µ
  recommendations: [
    "–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–ª–æ–µ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤"
  ]
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ —Å–±–æ—Ä–∫–∏:

```yaml
# .github/workflows/validate.yml
steps:
  - name: Validate dependencies
    run: rpi-image-gen layer --validate config.yaml

  - name: Check cohesion metrics
    run: |
      score=$(rpi-image-gen analyze --cohesion config.yaml --format json | jq .overall_score)
      if (( $(echo "$score < 80" | bc -l) )); then
        echo "Cohesion score too low: $score"
        exit 1
      fi

  - name: Generate dependency graph
    run: rpi-image-gen layer --graph config.yaml --output dependencies.png
    if: always()
```

### –ü–æ—Ä–æ–≥ –∫–∞—á–µ—Å—Ç–≤–∞
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞—á–µ—Å—Ç–≤—É:

```yaml
# –ü–æ—Ä–æ–≥–∏ –∫–∞—á–µ—Å—Ç–≤–∞
quality_gates:
  cohesion_score: 80
  max_dependency_depth: 5
  cycles_allowed: 0
  compatibility_issues: 0
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏:

```yaml
# –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
quality_targets:
  cohesion_score: 70
  max_depth: 7

# –≠—Ç–∞–ø 2: –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
quality_targets:
  cohesion_score: 80
  max_depth: 5

# –≠—Ç–∞–ø 3: –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
quality_targets:
  cohesion_score: 90
  max_depth: 4
```

### –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï**: –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–≤—è–∑–µ–π:

```markdown
## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–ª–æ—è security-advanced

### –¢—Ä–µ–±—É–µ–º—ã–µ —Å–ª–æ–∏
- `security-basic` (>= 1.0.0): –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `system-monitoring` (>= 2.1.0): –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `audit-extended` (>= 1.2.0): –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞—É–¥–∏—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- `security-minimal`: –í–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∂–∏–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

## –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
- [ ] –î–µ—Ç–µ–∫—Ü–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] –ê–Ω–∞–ª–∏–∑ –≥–ª—É–±–∏–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π
- [ ] –†–∞—Å—á–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- [ ] Cohesion index > 80% –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- [ ] –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚â§ 5
- [ ] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π –≤ —Ä–µ–ª–∏–∑–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö
- [ ] –ù–∞–ª–∏—á–∏–µ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ –æ –∫–∞—á–µ—Å—Ç–≤–µ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
- [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —É—Ö—É–¥—à–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –ò—Å—Ç–æ—á–Ω–∏–∫
–°–æ–∑–¥–∞–Ω–æ –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –ø—Ä–∞–≤–∏–ª—É 00-rule-transitions.mdc –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π rpi-image-gen.