---
alwaysApply: ${cursor.file.path.includes("layer/") || cursor.file.path.includes("config/")}
---

# –ü—Ä–∞–≤–∏–ª–æ 17-1: –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–±–æ—Ä–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π rpi-image-gen, –≤–∫–ª—é—á–∞—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è initramfs.

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–∞–∫–µ—Ç–æ–≤

### –ü—Ä–∏–Ω—Ü–∏–ø: –ü–∞–∫–µ—Ç—ã —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

#### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫
```yaml
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ –ø–∞–∫–µ—Ç—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
mmdebstrap:
  packages:
    - nginx
    - curl
    - wget
  customize-hooks:
    - |
      #!/bin/bash
      set -euo pipefail

      # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
      if ! command -v nginx >/dev/null 2>&1; then
        die "nginx –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞"
      fi

      # –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
      # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ curl –∏ wget —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ packages
```

#### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
```yaml
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–º–µ–¥–ª—è—é—Ç —Å–±–æ—Ä–∫—É
mmdebstrap:
  packages:
    - nginx
    - curl
    - wget
  customize-hooks:
    - |
      # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç - –∑–∞–º–µ–¥–ª—è–µ—Ç —Å–±–æ—Ä–∫—É
      for pkg in nginx curl wget jq netcat-openbsd; do
        if ! command -v "$pkg" >/dev/null 2>&1; then
          echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ $pkg..."
          apt-get update && apt-get install -y "$pkg"
        fi
      done

      # –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
      [[ -x "$(command -v nginx)" ]] || die "nginx failed"
      [[ -x "$(command -v curl)" ]] || die "curl failed"
```

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

#### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
```yaml
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
mmdebstrap:
  packages:
    - nginx
    - curl
  customize-hooks:
    - |
      #!/bin/bash
      set -euo pipefail

      # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
      if [[ ! -f /etc/nginx/sites-available/default ]]; then
        cat > /etc/nginx/sites-available/default << 'EOF'
        server {
            listen 80 default_server;
            root /var/www/html;
            index index.html;
        }
        EOF
      fi

      # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
      if ! grep -q "client_max_body_size" /etc/nginx/nginx.conf; then
        sed -i '/http {/a \    client_max_body_size 100M;' /etc/nginx/nginx.conf
      fi

      # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
      [[ -d /var/log/nginx ]] || mkdir -p /var/log/nginx
      [[ -d /var/cache/nginx ]] || mkdir -p /var/cache/nginx

      # –í–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω
      if ! systemctl is-enabled nginx >/dev/null 2>&1; then
        systemctl enable nginx
      fi

      # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
      if [[ -f /etc/nginx/nginx.conf ]]; then
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ checksum –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
        local current_checksum=$(md5sum /etc/nginx/nginx.conf | cut -d' ' -f1)
        sed -i '/worker_processes/auto/a worker_rlimit_nofile 1024;' /etc/nginx/nginx.conf
        local new_checksum=$(md5sum /etc/nginx/nginx.conf | cut -d' ' -f1)

        if [[ "$current_checksum" != "$new_checksum" ]]; then
          echo "Nginx config updated, reload needed"
          # –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
          touch /tmp/nginx-reload-needed
        fi
      fi
```

#### –®–∞–±–ª–æ–Ω—ã –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

##### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```bash
# –®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
create_config_file() {
  local file_path="$1"
  local content="$2"
  local backup="${3:-true}"

  # –°–æ–∑–¥–∞–Ω–∏–µ backup –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  if [[ -f "$file_path" && "$backup" == "true" ]]; then
    cp "$file_path" "${file_path}.backup.$(date +%Y%m%d_%H%M%S)"
  fi

  # –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø—É—Å—Ç–æ–π
  if [[ ! -f "$file_path" || ! -s "$file_path" ]]; then
    echo "$content" > "$file_path"
    echo "Created: $file_path"
  else
    echo "Skipped (exists): $file_path"
  fi
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
create_config_file "/etc/myapp/config.conf" "setting=value"
```

##### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```bash
# –®–∞–±–ª–æ–Ω –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
add_config_line() {
  local file_path="$1"
  local line="$2"
  local marker="${3:-}"

  if [[ -n "$marker" ]]; then
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å –º–∞—Ä–∫–µ—Ä–æ–º –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    if ! grep -q "$marker" "$file_path" 2>/dev/null; then
      echo "$line #$marker" >> "$file_path"
      echo "Added to $file_path: $line"
    fi
  else
    # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏
    if ! grep -q "^$(escape_sed "$line")$" "$file_path" 2>/dev/null; then
      echo "$line" >> "$file_path"
      echo "Added to $file_path: $line"
    fi
  fi
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
add_config_line "/etc/fstab" "UUID=123 /mnt/data ext4 defaults 0 2" "data-mount"
```

##### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ systemd —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –®–∞–±–ª–æ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞–º–∏
manage_service() {
  local service_name="$1"
  local action="$2"  # enable|disable|start|stop|restart
  local condition="${3:-}"  # –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ

  case "$action" in
    "enable")
      if [[ -z "$condition" ]] || eval "$condition"; then
        if ! systemctl is-enabled "$service_name" >/dev/null 2>&1; then
          systemctl enable "$service_name"
          echo "Enabled service: $service_name"
        fi
      fi
      ;;
    "start")
      if ! systemctl is-active "$service_name" >/dev/null 2>&1; then
        systemctl start "$service_name"
        echo "Started service: $service_name"
      fi
      ;;
    "restart")
      if systemctl is-active "$service_name" >/dev/null 2>&1; then
        systemctl restart "$service_name"
        echo "Restarted service: $service_name"
      fi
      ;;
  esac
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
manage_service "nginx" "enable"
manage_service "nginx" "start"
```

##### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä—É–ø–ø
```bash
# –®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
create_user_idempotent() {
  local username="$1"
  local uid="${2:-}"
  local home_dir="${3:-/home/$username}"
  local shell="${4:-/bin/bash}"

  if ! id -u "$username" >/dev/null 2>&1; then
    if [[ -n "$uid" ]]; then
      useradd -u "$uid" -m -d "$home_dir" -s "$shell" "$username"
    else
      useradd -m -d "$home_dir" -s "$shell" "$username"
    fi
    echo "Created user: $username"
  else
    echo "User exists: $username"
  fi
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
create_user_idempotent "appuser" "1001" "/var/lib/appuser" "/bin/false"
```

##### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏
```bash
# –®–∞–±–ª–æ–Ω –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
install_package_if_missing() {
  local package="$1"

  if ! dpkg -l "$package" >/dev/null 2>&1; then
    echo "Installing package: $package"
    apt-get update && apt-get install -y "$package"
  else
    echo "Package already installed: $package"
  fi
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
install_package_if_missing "curl"
install_package_if_missing "jq"
```

#### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –Ω–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```yaml
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –Ω–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
mmdebstrap:
  packages:
    - nginx
  customize-hooks:
    - |
      # –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
      cat > /etc/nginx/sites-available/default << 'EOF'  # –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç!
      server {
          listen 80 default_server;
          root /var/www/html;
          index index.html;
      }
      EOF

      # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
      echo "client_max_body_size 100M;" >> /etc/nginx/nginx.conf  # –ú–æ–∂–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å!

      # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
      mkdir /var/log/nginx    # –û—à–∏–±–∫–∞ –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      mkdir /var/cache/nginx  # –û—à–∏–±–∫–∞ –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

      # –í–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
      systemctl enable nginx  # –û—à–∏–±–∫–∞ –µ—Å–ª–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è initramfs üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

#### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ rootfs
```yaml
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ initramfs —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ü–µ
mmdebstrap:
  packages:
    - linux-image-arm64
    - initramfs-tools
  customize-hooks:
    - |
      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —è–¥—Ä–∞ –∏ –º–æ–¥—É–ª–µ–π (–±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è initramfs)
      echo "options i2c_arm on" > /etc/modprobe.d/i2c.conf
      echo "i2c-dev" >> /etc/modules
      echo "dtoverlay=vc4-fkms-v3d" >> /boot/config.txt

    - |
      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ initrd (–±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
      cat > /etc/initramfs-tools/modules << 'EOF'
      # Kernel modules for initramfs
      ext4
      mmc_block
      EOF

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ initramfs —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑ –≤ –∫–æ–Ω—Ü–µ —Å–±–æ—Ä–∫–∏
finalize-hooks:
  - |
    # –ï–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ initramfs –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
    update-initramfs -u -k all
```

#### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```yaml
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è initramfs
mmdebstrap:
  packages:
    - linux-image-arm64
  customize-hooks:
    - |
      # –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ - –∑–∞–º–µ–¥–ª—è–µ—Ç —Å–±–æ—Ä–∫—É
      echo "dtoverlay=vc4-fkms-v3d" >> /boot/config.txt
      update-initramfs -u

    - |
      # –í—Ç–æ—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ - –µ—â–µ –±–æ–ª—å—à–µ –∑–∞–º–µ–¥–ª—è–µ—Ç
      echo "i2c-dev" >> /etc/modules
      update-initramfs -u

    - |
      # –¢—Ä–µ—Ç—å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ - –∫—Ä–∏—Ç–∏—á–Ω–æ –∑–∞–º–µ–¥–ª—è–µ—Ç
      cat > /etc/initramfs-tools/hooks/custom >> /dev/null
      update-initramfs -u
```

## –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã ‚ùå –ó–ê–ü–†–ï–©–ï–ù–´

### –ù–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```bash
# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û - –Ω–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
cat > /etc/nginx/sites-available/default << 'EOF'  # –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç!
server { ... }
EOF

# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û - –Ω–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
echo "setting=value" >> /etc/config.conf  # –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã

# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û - –Ω–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir /var/log/app  # –û—à–∏–±–∫–∞ –µ—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û - –Ω–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
systemctl enable myservice  # –û—à–∏–±–∫–∞ –µ—Å–ª–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω
```

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
```bash
# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û - –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
if ! command -v package1; then apt-get install package1; fi
if ! command -v package2; then apt-get install package2; fi
if ! command -v package1; then echo "package1 check again"; fi  # –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è initramfs
```bash
# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
update-initramfs -u  # –ü–µ—Ä–≤–æ–µ
# ... –¥—Ä—É–≥–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ...
update-initramfs -u  # –í—Ç–æ—Ä–æ–µ
# ... –µ—â–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ...
update-initramfs -u  # –¢—Ä–µ—Ç—å–µ - –∑–∞–º–µ–¥–ª—è–µ—Ç —Å–±–æ—Ä–∫—É –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ
```

### –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
apt-get update  # –ö–∞–∂–¥—ã–π —Ä–∞–∑ –∑–∞–Ω–æ–≤–æ
apt-get install package  # –ë–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞
```

### –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```bash
# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û - –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
cat > /etc/fstab << 'EOF'  # –£–Ω–∏—á—Ç–æ–∂–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# –ü–æ—Ç–µ—Ä—è–Ω—ã –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ mount —Ç–æ—á–∫–∏
EOF

cat > /etc/passwd << 'EOF'  # –£–Ω–∏—á—Ç–æ–∂–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
# –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ–π
EOF
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- [ ] –ü—Ä–∞–≤–∏–ª–æ –∏–∑—É—á–µ–Ω–æ –∏ –ø–æ–Ω—è—Ç–æ –∫–æ–º–∞–Ω–¥–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [ ] –°–æ–±–ª—é–¥–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤ CI/CD
- [ ] –ù–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –º–µ—Ä–¥–∂–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∞—É–¥–∏—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- [ ] 100% —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ
- [ ] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–µ—Ç–∫–∞—Ö
- [ ] –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã (–º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [ ] –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –ø—Ä–∞–≤–∏–ª–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- [ ] –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º/–∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
- [ ] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
- [ ] –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏

### –ò—Å—Ç–æ—á–Ω–∏–∫
