---
alwaysApply: ${cursor.file.path.includes("layer/") || cursor.file.path.includes("config/") || cursor.file.isNew}
---


# ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ 31: AI-Ð°ÑÑÐ¸ÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼Ð°Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð² Cursor

## ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°
ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸ÑŽ Ñ Cursor AI Assistant Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ð¹ rpi-image-gen.

## ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ ðŸ”´ ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐ«Ð•

## Cursor AI Prompts Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ð¹

### Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð³Ð¾ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ
```
Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ rpi-image-gen Ð´Ð»Ñ [Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ] ÑÐ¾ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¼Ð¸ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ°Ð¼Ð¸:
- Ð¢Ð¸Ð¿ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ: [device|application|infrastructure]
- Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ ÑÐ»Ð¾Ð¹: [ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸Ð· layer/]
- ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸: [ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…]
- Ð¥ÑƒÐºÐ¸: setup, customize, cleanup
- Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ
- Ð¢ÐµÑÑ‚Ñ‹ Ð´Ð»Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸
- ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Debian Trixie (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
- A/B boot ÑÐ¸ÑÑ‚ÐµÐ¼Ð° (Ð´Ð»Ñ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹)
- Ð¡Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ñ‹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸ (TLS, MQTT)
```

### Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
```
ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ÑÑ‚ÑŒ YAML ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ rpi-image-gen:
- Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð°Ð¼ (device/image/layer ÑÐµÐºÑ†Ð¸Ð¸)
- ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð¼ÐµÑŽÑ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÑ‹ IGconf_*
- Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑÐ»Ð¾ÐµÐ² ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð² X-Env-Layer-Requires
- ÐœÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ (X-Env-Layer-*)
- ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð¸Ð¼ÐµÑŽÑ‚ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ (X-Env-Var-*-Valid)
```

### Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Debian Trixie
```
Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Debian Trixie:
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ suite: trixie Ð² mmdebstrap
- Ð£Ð±ÐµÐ´Ð¸ÑÑŒ Ð² ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
- Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ testing-specific Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
- Ð’ÐºÐ»ÑŽÑ‡Ð¸ ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð²ÐµÑ€ÑÐ¸Ð¸ toolchain (Rust, Go)
- Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ Ð´Ð»Ñ Trixie-specific Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
```

### ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° A/B Boot ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
```
Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐ¹ A/B Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð´Ð»Ñ rpi-image-gen:
- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ tryboot Ñ fallback Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼Ð¾Ð¼
- Ð¡Ð¾Ð·Ð´Ð°Ð¹ systemd ÑÐµÑ€Ð²Ð¸Ñ Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹
- Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐ¹ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€ ÑÐ»Ð¾Ñ‚Ð¾Ð²
- Ð”Ð¾Ð±Ð°Ð²ÑŒ GPT labels Ð´Ð»Ñ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ ÑÐ»Ð¾Ñ‚Ð¾Ð²
- Ð’ÐºÐ»ÑŽÑ‡Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹
```

### ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
```
ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€ÑƒÐ¹ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ rpi-image-gen Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸:
- ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ CPU/Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ð² Ñ…ÑƒÐºÐ°Ñ…
- ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶Ð¸ Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹
- ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€ÑƒÐ¹ Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð¾Ð±Ñ€Ð°Ð·Ð° (ÑƒÐ´Ð°Ð»Ð¸ Ð½ÐµÐ¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹)
- Ð”Ð¾Ð±Ð°Ð²ÑŒ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð»Ñ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÑŽÑ‰Ð¸Ñ…ÑÑ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ PMAP Ð´Ð»Ñ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ð°Ð¼ÑÑ‚Ð¸
```

### ÐžÑ‚Ð»Ð°Ð´ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ ÑÐ±Ð¾Ñ€ÐºÐ¸
```
ÐÐ°Ð¹Ð´Ð¸ Ð¸ Ð¸ÑÐ¿Ñ€Ð°Ð²ÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ Ð² ÑÐ±Ð¾Ñ€ÐºÐµ rpi-image-gen:
- ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹ Ð»Ð¾Ð³Ð¸ ÑÐ±Ð¾Ñ€ÐºÐ¸ Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ ÑÐ»Ð¾ÑÐ¼Ð¸
- Ð’Ð°Ð»Ð¸Ð´Ð¸Ñ€ÑƒÐ¹ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
- ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶Ð¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ñ‚Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼
```

## Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð½Ñ‹Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñ‹

### Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÑÐ»Ð¾ÐµÐ²

#### Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ ÑÐ»Ð¾ÐµÐ²
```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐ»Ð¾Ñ Ñ Ð¸Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¼ Ð¼Ð°ÑÑ‚ÐµÑ€Ð¾Ð¼
rpi-image-gen layer --create --interactive

# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°
rpi-image-gen layer --template security-core --name my-security-layer

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐ»Ð¾Ñ Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑÐ¼Ð¸
rpi-image-gen layer --create --depends "apparmor-core,auditd-core" --category security
```

#### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ…
```yaml
# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð¸Ð· Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²
# X-Env-Layer-Name: my-extension
# X-Env-Layer-Category: security
# X-Env-Layer-Description: Auto-generated security extension
# X-Env-Layer-Version: 1.0.0
# X-Env-Layer-Requires: locale-base
# X-Env-VarPrefix: my_extension
```

### Device Extension Template
```yaml
# METABEGIN
# X-Env-Layer-Name: ${extension_name}
# X-Env-Layer-Category: device
# X-Env-Layer-Description: ${description}
# X-Env-Layer-Version: 1.0.0
# X-Env-Layer-Requires: essential
# X-Env-VarPrefix: device
#
# X-Env-Var-firmware_version: latest
# X-Env-Var-firmware_version-Description: Ð’ÐµÑ€ÑÐ¸Ñ firmware Ð´Ð»Ñ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°
# X-Env-Var-firmware_version-Required: false
# X-Env-Var-firmware_version-Valid: latest,stable,beta
# X-Env-Var-enable_pmap: true
# X-Env-Var-enable_pmap-Description: Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ PMAP Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð·Ð°
# X-Env-Var-enable_pmap-Required: false
# X-Env-Var-enable_pmap-Valid: true,false
# METAEND
---
mmdebstrap:
  packages:
    - raspberrypi-bootloader
    - raspberrypi-kernel
    - linux-firmware-raspi
    - rpi-eeprom
  customize-hooks:
    - |
      # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°
      configure_device_specifics() {
        local firmware_version="${IGconf_device_firmware_version:-latest}"
        local enable_pmap="${IGconf_device_enable_pmap:-true}"

        case "$firmware_version" in
          "latest") rpi-eeprom-update -a ;;
          "stable") rpi-eeprom-update ;;
          "beta") rpi-eeprom-update -r ;;
        esac

        # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° PMAP ÐµÑÐ»Ð¸ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ
        if [[ "$enable_pmap" = "true" ]]; then
          echo "PMAP Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð·Ð°"
          # PMAP Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ñ‹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
        fi

        # Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°
        echo "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð° ${IGconf_device_type:-unknown} Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°"
      }

      configure_device_specifics
```

### Debian Trixie Development Template ðŸ†• ÐÐžÐ’ÐžÐ•
```yaml
# METABEGIN
# X-Env-Layer-Name: ${extension_name}-trixie
# X-Env-Layer-Category: extension
# X-Env-Layer-Description: ${description} Ð½Ð° Ð±Ð°Ð·Ðµ Debian Trixie
# X-Env-Layer-Version: 1.0.0
# X-Env-Layer-Requires: essential
# X-Env-VarPrefix: trixie_dev
#
# X-Env-Var-rust_version: stable
# X-Env-Var-rust_version-Description: Ð’ÐµÑ€ÑÐ¸Ñ Rust toolchain
# X-Env-Var-rust_version-Required: false
# X-Env-Var-rust_version-Valid: stable,beta,nightly
# X-Env-Var-go_version: 1.21
# X-Env-Var-go_version-Description: Ð’ÐµÑ€ÑÐ¸Ñ Go toolchain
# X-Env-Var-go_version-Required: false
# X-Env-Var-go_version-Valid: 1.19,1.20,1.21
# METAEND
---
mmdebstrap:
  suite: trixie
  packages:
    - build-essential
    - git
    - curl
    - wget
    - python3-dev
    - nodejs
    - npm
  customize-hooks:
    - |
      # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÑ€ÐµÐ´Ñ‹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Debian Trixie
      setup_trixie_development() {
        local rust_version="${IGconf_trixie_dev_rust_version:-stable}"
        local go_version="${IGconf_trixie_dev_go_version:-1.21}"

        # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Rust
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
        source $HOME/.cargo/env
        rustup install "$rust_version"
        rustup default "$rust_version"
        rustup component add rustfmt clippy

        # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Go
        wget -O go.tar.gz "https://golang.org/dl/go${go_version}.linux-arm64.tar.gz"
        tar -C /usr/local -xzf go.tar.gz
        echo 'export PATH=$PATH:/usr/local/go/bin' >> /etc/profile
        echo 'export GOPATH=/opt/go' >> /etc/profile

        # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Python Ð¸ Node.js Ð´Ð»Ñ Trixie
        pip3 install --break-system-packages virtualenvwrapper
        npm install -g yarn pnpm

        echo "Ð¡Ñ€ÐµÐ´Ð° Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Debian Trixie Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð°"
      }

      setup_trixie_development
```

### Application Extension Template
```yaml
# METABEGIN
# X-Env-Layer-Name: ${extension_name}
# X-Env-Layer-Category: extension
# X-Env-Layer-Description: ${description}
# X-Env-Layer-Version: 1.0.0
# X-Env-Layer-Requires: essential,net-misc
# X-Env-VarPrefix: app
#
# X-Env-Var-service_port: 8080
# X-Env-Var-service_port-Description: ÐŸÐ¾Ñ€Ñ‚ Ð´Ð»Ñ Ð²ÐµÐ±-ÑÐµÑ€Ð²Ð¸ÑÐ°
# X-Env-Var-service_port-Required: false
# X-Env-Var-service_port-Valid: int:1024-65535
# METAEND
---
mmdebstrap:
  packages:
    - ${app_packages:-curl wget}
  customize-hooks:
    - |
      # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
      install_application() {
        local port="${IGconf_app_service_port:-8080}"

        # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
        useradd --system --shell /bin/false --home /var/lib/${IGconf_app_name} ${IGconf_app_name}

        # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÑ€Ð²Ð¸ÑÐ°
        cat > /etc/systemd/system/${IGconf_app_name}.service << EOF
[Unit]
Description=${IGconf_app_description:-Application Service}
After=network.target

[Service]
User=${IGconf_app_name}
ExecStart=/usr/local/bin/${IGconf_app_name} --port $port
Restart=always

[Install]
WantedBy=multi-user.target
EOF

        systemctl enable ${IGconf_app_name}
      }

      install_application
```

## Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Cursor

### Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ
```bash
# Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ ÑÐ»Ð¾Ñ
rpi-image-gen layer --describe ${layer_name}

# Ð¢ÐµÑÑ‚Ð¾Ð²Ð°Ñ ÑÐ±Ð¾Ñ€ÐºÐ°
rpi-image-gen build -c ${config_file} --dry-run

# Ð›Ð¸Ð½Ñ‚Ð¸Ð½Ð³ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
rpi-image-gen metadata --lint ${layer_file}
```

### ÐžÑ‚Ð»Ð°Ð´ÐºÐ° ÑÐ±Ð¾Ñ€ÐºÐ¸
```bash
# Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
export VERBOSE=1
rpi-image-gen build -c ${config_file}

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
rpi-image-gen layer --list --depends ${layer_name}

# ÐÐ½Ð°Ð»Ð¸Ð· Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
env | grep IGconf_ | sort
```

### ÐŸÑ€Ð¾Ñ„Ð¸Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
```bash
# ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð² Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ ÑÐ±Ð¾Ñ€ÐºÐ¸
time rpi-image-gen build -c ${config_file}

# ÐÐ½Ð°Ð»Ð¸Ð· Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° Ð¾Ð±Ñ€Ð°Ð·Ð°
ls -lh work/image-*/image-*.img
```

## Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Cursor IDE

### ÐÐ²Ñ‚Ð¾Ð´Ð¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
- `IGconf_extension_*` - Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ
- `IGconf_device_*` - Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°
- `IGconf_image_*` - Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð·Ð°

### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ
- Ð¡Ð¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ YAML Ð¿Ñ€Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ð¸
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ¾Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
- Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ ÑÐ»Ð¾ÐµÐ²
- ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ Ð¾ Ð»ÑƒÑ‡ÑˆÐ¸Ñ… Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ°Ñ…

---

### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð´Ð°

#### Ð£Ð¼Ð½Ñ‹Ðµ ÑÐ½Ð¸Ð¿Ð¿ÐµÑ‚Ñ‹ Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ
```bash
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ ÑÐ»Ð¾Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸
generate-security-layer() {
    local name="$1"
    local category="${2:-security}"

    # ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹
    mkdir -p "layer/${category}/${name}"
    generate-metadata "$name" "$category"
    generate-config "$name"
    generate-hooks "$name"
    generate-tests "$name"
}

# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
generate-variables() {
    local prefix="$1"
    local vars="$2"

    echo "# X-Env-VarPrefix: $prefix"
    for var in $vars; do
        echo "# X-Env-Var-${var}: \${default_value}"
        echo "# X-Env-Var-${var}-Desc: Description for $var"
        echo "# X-Env-Var-${var}-Required: n"
        echo "# X-Env-Var-${var}-Valid: string"
        echo "# X-Env-Var-${var}-Set: lazy"
        echo "#"
    done
}

# ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ
generate-security-layer "my-hardening" "security"
generate-variables "my_hardening" "enable mode level"
```

#### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
```bash
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚Ð¸Ð¿Ð¾Ð²Ñ‹Ñ… Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
generate-error-handling() {
    cat << 'EOF'
# Function for error handling
die() {
    echo "ERROR: $*" >&2
    exit 1
}

warn() {
    echo "WARN: $*" >&2
}
EOF
}

generate-validation() {
    local component="$1"
    cat << EOF
# Validate component enablement
validate_component_enabled() {
    local component="\$1"
    igconf isy "IGconf_\${component}_enable" || {
        echo "Component \$component is disabled"
        exit 0
    }
}
EOF
}

# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð²ÑÑ‚Ð°Ð²ÐºÐ° Ð² Ð½Ð¾Ð²Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
generate-boilerplate() {
    echo "#!/bin/bash"
    echo "set -euo pipefail"
    echo ""
    generate-error-handling
    echo ""
    generate-validation "component_name"
}
```

## ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ ÑÐ¾Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° ðŸ”´ ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐ«Ð•

### ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹
- [ ] ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¾ Ð¸ Ð¿Ð¾Ð½ÑÑ‚Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
- [ ] Ð¡Ð¾Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð² CI/CD
- [ ] ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð¿Ñ€Ð¸Ð²Ð¾Ð´ÑÑ‚ Ðº Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐµ Ð¼ÐµÑ€Ð´Ð¶Ð°
- [ ] Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð° Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°
- [ ] Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ñ‹Ð¹ Ð°ÑƒÐ´Ð¸Ñ‚ ÑÐ¾Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°

### ÐšÐ°Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸
- [ ] 100% ÑÐ¾Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð² Ð½Ð¾Ð²Ð¾Ð¼ ÐºÐ¾Ð´Ðµ
- [ ] ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ð¹ Ð² Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… Ð²ÐµÑ‚ÐºÐ°Ñ…
- [ ] ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ñ
- [ ] ÐžÐ±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ²ÑÐ·ÑŒ Ð¾Ñ‚ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
- [ ] ÐÐµÐ¿Ñ€ÐµÑ€Ñ‹Ð²Ð½Ð¾Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²Ð¾Ðº Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°

### Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº
Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾ Ð´Ð»Ñ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ rpi-image-gen Ð² Cursor IDE