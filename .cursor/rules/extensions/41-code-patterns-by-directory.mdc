---
alwaysApply: ${cursor.file.path.includes("layer/") || cursor.file.path.includes("config/")}
---


# –ü—Ä–∞–≤–∏–ª–æ 41: –ü—Ä–∞–≤–∏–ª–∞ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–¥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞
[–ö –Ω–∞—á–∞–ª—É ‚Üë](#–ø—Ä–∞–≤–∏–ª–∞-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π-–¥–ª—è-rpi-image-gen) | [–ö —Ä–∞–∑–¥–µ–ª—É "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞" ‚Üí](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞-–∏-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-–∫–∞—Ç–∞–ª–æ–≥–æ–≤) |

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

## –ü—Ä–∞–≤–∏–ª–∞ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–¥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞

[–ö –Ω–∞—á–∞–ª—É ‚Üë](#–ø—Ä–∞–≤–∏–ª–∞-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π-–¥–ª—è-rpi-image-gen) |
[–ö —Ä–∞–∑–¥–µ–ª—É "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞" ‚Üí](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞-–∏-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-–∫–∞—Ç–∞–ª–æ–≥–æ–≤) |
[–ö —Ä–∞–∑–¥–µ–ª—É "–ö–∞—Ç–∞–ª–æ–≥ bin" ‚Üí](#bin---–∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ-—Ñ–∞–π–ª—ã-–∏-—É—Ç–∏–ª–∏—Ç—ã) |
[–ö —Ä–∞–∑–¥–µ–ª—É "–ö–∞—Ç–∞–ª–æ–≥ config" ‚Üí](#config---–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ-—Ñ–∞–π–ª—ã)

<a id="—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞-–∏-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-–∫–∞—Ç–∞–ª–æ–≥–æ–≤"></a>

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–≤: üî¥ *–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï*

```
rpi-image-gen/
‚îú‚îÄ‚îÄ bin/                    # –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ config/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ device/                 # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îú‚îÄ‚îÄ docs/                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ examples/               # –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ image/                  # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–∑–æ–≤
‚îú‚îÄ‚îÄ layer/                  # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–ª–æ–µ–≤ —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ layer-hooks/           # –•—É–∫–∏ –¥–ª—è —Å–ª–æ–µ–≤
‚îú‚îÄ‚îÄ lib/                    # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ scripts/               # –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ site/                  # Python –º–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ templates/             # –®–∞–±–ª–æ–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test/                  # –¢–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ work/                  # –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–±–æ—Ä–∫–∏
```

<a id="bin---–∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ-—Ñ–∞–π–ª—ã-–∏-—É—Ç–∏–ª–∏—Ç—ã"></a>

### bin/ - –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã –∏ —É—Ç–∏–ª–∏—Ç—ã: üî¥ *–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï*

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–ö–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å rpi-image-gen.

#### –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è:
- **–ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã**: `*.sh` (bash —Å–∫—Ä–∏–ø—Ç—ã)
- **–ë–∏–Ω–∞—Ä–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã**: –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏–ª–∏ `.py` –¥–ª—è Python —Å–∫—Ä–∏–ø—Ç–æ–≤
- **–£—Ç–∏–ª–∏—Ç—ã**: `*-helper`, `*-tool`, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è

#### –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:

**–î–ª—è bash —Å–∫—Ä–∏–ø—Ç–æ–≤:**
```bash
#!/bin/bash
# shellcheck disable=SC2154,SC2086

set -euo pipefail

# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
readonly SCRIPT_NAME="$(basename "${BASH_SOURCE[0]}")"
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# –§—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
log_info() { echo "[$SCRIPT_NAME] INFO: $*"; }
log_warn() { echo "[$SCRIPT_NAME] WARN: $*" >&2; }
log_error() { echo "[$SCRIPT_NAME] ERROR: $*" >&2; }

# –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å –æ—à–∏–±–∫–æ–π
die() {
    log_error "$*"
    exit 1
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
check_dependencies() {
    local deps=("tool1" "tool2" "tool3")
    for dep in "${deps[@]}"; do
        command -v "$dep" >/dev/null 2>&1 || die "–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: $dep"
    done
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
main() {
    check_dependencies

    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
    log_info "–ó–∞–ø—É—Å–∫ –æ–ø–µ—Ä–∞—Ü–∏–∏"

    # –í–æ–∑–≤—Ä–∞—Ç –∫–æ–¥–∞ —É—Å–ø–µ—Ö–∞
    return 0
}

# –ó–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
main "$@"
```

**–ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- **–£—Ç–∏–ª–∏—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏** –¥–æ–ª–∂–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å `--help` –∏ `--version`
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã** –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `$INTERACTIVE`
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `set -euo pipefail`

#### –ü—Ä–∏–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤:
- `runner` - –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Ö—É–∫–æ–≤ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- `uchroot` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π chroot –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
- `ig` - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ—è–º–∏

<a id="config---–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ-—Ñ–∞–π–ª—ã"></a>

### config/ - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã: üî¥ *–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï*

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤ –≤ YAML —Ñ–æ—Ä–º–∞—Ç–µ.

#### –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è:
- **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: `{distro}-{variant}.yaml` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `bookworm-minbase.yaml`)
- **–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: `{feature}-{distro}.yaml`
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: `{project}-{config}.yaml`

#### –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```yaml
# –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞)
# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Debian Bookworm
# –í–µ—Ä—Å–∏—è: 1.0.0
# –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: –î–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–µ—Ä–≤–æ–π –≤ —Ü–µ–ø–æ—á–∫–µ —Å–±–æ—Ä–∫–∏

# –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
device:
  layer: pi5                    # –°–ª–æ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  hostname: rpi-${HOST_SUFFIX}  # –®–∞–±–ª–æ–Ω –∏–º–µ–Ω–∏ —Ö–æ—Å—Ç–∞
  user: pi                     # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∏—Å—Ç–µ–º—ã

image:
  layer: image-rpios           # –°–ª–æ–π –æ–±—Ä–∞–∑–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  boot_part_size: 200%         # –†–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
  root_part_size: 300%         # –†–∞–∑–º–µ—Ä –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
  name: deb12-arm64-min        # –ò–º—è —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–≥–æ –æ–±—Ä–∞–∑–∞

layer:
  base: bookworm-minbase       # –ë–∞–∑–æ–≤—ã–π —Å–ª–æ–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–∏ –ø–µ—Ä–µ—á–∏—Å–ª—è—é—Ç—Å—è –∑–¥–µ—Å—å
  security: security-minimal
  network: net-misc
```

**–ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ —Ñ–æ—Ä–º–∞—Ç–µ `${VAR_NAME}`
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏

<a id="device---—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏-—É—Å—Ç—Ä–æ–π—Å—Ç–≤"></a>

### device/ - –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤: ‚ö†Ô∏è *–û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï*

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π Raspberry Pi.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤:
```
device/
‚îú‚îÄ‚îÄ {device_name}/           # –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (pi5, cm4, zero2w)
‚îÇ   ‚îú‚îÄ‚îÄ device.yaml         # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
‚îÇ   ‚îú‚îÄ‚îÄ device.adoc         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
‚îÇ   ‚îú‚îÄ‚îÄ bdebstrap/          # –•—É–∫–∏ –¥–ª—è —ç—Ç–∞–ø–æ–≤ bdebstrap
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setup*         # –•—É–∫–∏ —ç—Ç–∞–ø–∞ setup
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ essential*     # –•—É–∫–∏ —ç—Ç–∞–ø–∞ essential
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customize*     # –•—É–∫–∏ —ç—Ç–∞–ø–∞ customize
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cleanup*       # –•—É–∫–∏ —ç—Ç–∞–ø–∞ cleanup
‚îÇ   ‚îú‚îÄ‚îÄ initramfs-tools/   # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ initramfs
‚îÇ   ‚îî‚îÄ‚îÄ rootfs-overlay/    # –û–≤–µ—Ä–ª–µ–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
```

#### –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è device.yaml:

```yaml
# METABEGIN
# X-Env-Layer-Name: pi5
# X-Env-Layer-Category: device
# X-Env-Layer-Description: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Raspberry Pi 5
# X-Env-Layer-Version: 1.0.0
# X-Env-Layer-Requires: essential,rpi-base
# X-Env-VarPrefix: device
#
# X-Env-Var-hostname: pi5-${HOST_SUFFIX}
# X-Env-Var-hostname-Description: –ò–º—è —Ö–æ—Å—Ç–∞ –¥–ª—è Pi 5
# X-Env-Var-hostname-Required: false
# X-Env-Var-hostname-Valid: regex:^[a-zA-Z0-9.-]+$
# X-Env-Var-hostname-Set: immediate
#
# X-Env-Var-firmware_version: latest
# X-Env-Var-firmware_version-Description: –í–µ—Ä—Å–∏—è firmware –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
# X-Env-Var-firmware_version-Required: false
# X-Env-Var-firmware_version-Valid: latest,stable,beta
# METAEND
---
mmdebstrap:
  packages:
    - raspberrypi-bootloader
    - raspberrypi-kernel
    - linux-firmware-raspi
  setup-hooks:
    - |
      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
      echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ${IGconf_device_hostname}"
  customize-hooks:
    - |
      # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ firmware
      if [ "${IGconf_device_firmware_version}" = "latest" ]; then
        rpi-eeprom-update -a
      fi
```

#### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ö—É–∫–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:

```bash
#!/bin/bash
# device/{device_name}/bdebstrap/customize-device-setup

set -euo pipefail

# –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
configure_device_specifics() {
    local device_type="$1"

    case "$device_type" in
        "pi5")
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Raspberry Pi 5
            configure_pi5_specifics
            ;;
        "cm4")
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Compute Module 4
            configure_cm4_specifics
            ;;
        *)
            warn "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: $device_type"
            ;;
    esac
}

configure_pi5_specifics() {
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è Pi 5
    apt-get install -y raspberrypi-bootloader-pi5

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —è–¥—Ä–∞
    cat >> /etc/modules << 'EOF'
bcm2712_wdt
bcm2712_thermal
EOF
}

# –í—ã–∑–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
configure_device_specifics "${IGconf_device_type:-pi5}"
```

<a id="image---—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏-–æ–±—Ä–∞–∑–æ–≤"></a>

---

## –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- [ ] –ü—Ä–∞–≤–∏–ª–æ –∏–∑—É—á–µ–Ω–æ –∏ –ø–æ–Ω—è—Ç–æ –∫–æ–º–∞–Ω–¥–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [ ] –°–æ–±–ª—é–¥–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤ CI/CD
- [ ] –ù–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –º–µ—Ä–¥–∂–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∞—É–¥–∏—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- [ ] 100% —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ
- [ ] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–µ—Ç–∫–∞—Ö
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [ ] –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –ø—Ä–∞–≤–∏–ª–∞

### –ò—Å—Ç–æ—á–Ω–∏–∫
–°–æ–∑–¥–∞–Ω–æ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: `42_–ø—Ä–∞–≤–∏–ª–∞_–∏_–ø–∞—Ç—Ç–µ—Ä–Ω—ã_–∫–æ–¥–∞_–¥–ª—è_–∫–∞–∂–¥–æ–≥–æ_–∫–∞—Ç–∞–ª–æ–≥–∞.mdc`
