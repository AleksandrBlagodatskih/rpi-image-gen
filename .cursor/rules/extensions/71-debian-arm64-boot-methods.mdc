---
alwaysApply: ${cursor.file.content.includes("boot") && !cursor.file.content.includes("secure")}
---


# –ü—Ä–∞–≤–∏–ª–æ 71: –ú–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ Debian arm64

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ Debian GNU/Linux –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É arm64, –∏—Å–∫–ª—é—á–∞—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è Raspberry Pi –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

## –ú–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ Debian arm64

### –ó–∞–≥—Ä—É–∑–∫–∞ —Å USB-–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—è

#### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ USB –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö ARM64 —Å–∏—Å—Ç–µ–º:
```bash
#!/bin/bash
# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ USB –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö ARM64 —Å–∏—Å—Ç–µ–º

prepare_usb_boot_generic() {
    local usb_device="$1"
    local iso_image="$2"

    echo "=== –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ USB –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Debian arm64 (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π) ==="

    if [ -z "$usb_device" ] || [ -z "$iso_image" ]; then
        echo "–û—à–∏–±–∫–∞: —É–∫–∞–∂–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –æ–±—Ä–∞–∑"
        echo "–ü—Ä–∏–º–µ—Ä: $0 /dev/sdb debian-arm64.iso"
        exit 1
    fi

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    if ! lsblk -o NAME,TYPE | grep -q "${usb_device#/dev/}.*disk"; then
        echo "–û—à–∏–±–∫–∞: $usb_device –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –±–ª–æ—á–Ω—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º"
        exit 1
    fi

    # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö
    echo "–í–ù–ò–ú–ê–ù–ò–ï: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ $usb_device –±—É–¥—É—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã!"
    read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/N): " confirm
    if [[ ! $confirm =~ ^[Yy]$ ]]; then
        exit 0
    fi

    # –†–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤
    echo "–†–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤..."
    for partition in $(lsblk -o NAME -ln "$usb_device" | grep -v "^${usb_device#/dev/}$"); do
        umount "/dev/$partition" 2>/dev/null || true
    done

    # –ó–∞–ø–∏—Å—å –æ–±—Ä–∞–∑–∞
    echo "–ó–∞–ø–∏—Å—å –æ–±—Ä–∞–∑–∞ Debian arm64..."
    if command -v pv >/dev/null 2>&1; then
        pv "$iso_image" | dd of="$usb_device" bs=4M status=none
    else
        dd if="$iso_image" of="$usb_device" bs=4M status=progress
    fi

    sync
    echo "USB –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ USB –∫ –∑–∞–≥—Ä—É–∑–∫–µ
verify_usb_bootable() {
    local usb_device="$1"

    echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ USB ==="

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤
    partitions=$(lsblk -o NAME -ln "$usb_device" | grep -v "^${usb_device#/dev/}$" | wc -l)
    echo "–ù–∞–π–¥–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–æ–≤: $partitions"

    if [ "$partitions" -eq 0 ]; then
        echo "USB –∑–∞–ø–∏—Å–∞–Ω –∫–∞–∫ –≥–∏–±—Ä–∏–¥–Ω—ã–π –æ–±—Ä–∞–∑ (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º)"
        return 0
    fi

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ñ–ª–∞–≥–∞
    for partition in $(lsblk -o NAME -ln "$usb_device" | grep -v "^${usb_device#/dev/}$"); do
        if parted -s "/dev/$partition" print | grep -q "boot"; then
            echo "–†–∞–∑–¥–µ–ª /dev/$partition –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π"
        fi
    done

    echo "USB –≥–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ"
}

main() {
    case "$1" in
        "prepare")
            shift
            prepare_usb_boot_generic "$@"
            ;;
        "verify")
            verify_usb_bootable "$2"
            ;;
        *)
            echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 <prepare|verify> [–ø–∞—Ä–∞–º–µ—Ç—Ä—ã]"
            exit 1
            ;;
    esac
}

main "$@"
```

### –°–µ—Ç–µ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (PXE/TFTP)

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PXE –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö ARM64 —Å–∏—Å—Ç–µ–º:
```bash
#!/bin/bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PXE –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è Debian arm64

setup_pxe_boot() {
    echo "=== –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PXE –∑–∞–≥—Ä—É–∑–∫–∏ Debian arm64 ==="

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TFTP —Å–µ—Ä–≤–µ—Ä–∞
    apt-get install -y tftpd-hpa

    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è TFTP
    TFTP_DIR="/srv/tftp"
    mkdir -p "$TFTP_DIR"

    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ netboot –æ–±—Ä–∞–∑–∞
    NETBOOT_URL="https://deb.debian.org/debian/dists/trixie/main/installer-arm64/current/images/netboot/"
    wget -r -np -nH --cut-dirs=3 -P "$TFTP_DIR" "$NETBOOT_URL"

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DHCP —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è PXE
    apt-get install -y isc-dhcp-server

    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DHCP
    cat > /etc/dhcp/dhcpd.conf << EOF
# DHCP configuration for PXE boot
subnet 192.168.1.0 netmask 255.255.255.0 {
    range 192.168.1.100 192.168.1.200;
    option routers 192.168.1.1;
    option domain-name-servers 8.8.8.8, 8.8.4.4;

    # PXE boot options
    filename "debian-installer/arm64/bootnetaa64.efi";
    next-server 192.168.1.1;

    # ARM64 specific options
    option arch code 93 = unsigned integer 16;
    if option arch = 00:0b {
        filename "debian-installer/arm64/bootnetaa64.efi";
    }
}
EOF

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è DHCP
    cat > /etc/default/isc-dhcp-server << EOF
INTERFACESv4="eth0"
EOF

    # –ó–∞–ø—É—Å–∫ —Å–ª—É–∂–±
    systemctl enable tftpd-hpa
    systemctl enable isc-dhcp-server
    systemctl start tftpd-hpa
    systemctl start isc-dhcp-server

    echo "PXE –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞"
    echo "–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫ —Å–µ—Ç–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ PXE boot"
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTP –∑–∞–≥—Ä—É–∑–∫–∏ (iPXE)
setup_http_boot() {
    echo "=== –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTP –∑–∞–≥—Ä—É–∑–∫–∏ (iPXE) ==="

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
    apt-get install -y nginx

    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –æ–±—Ä–∞–∑–æ–≤
    HTTP_DIR="/var/www/html/tftp"
    mkdir -p "$HTTP_DIR"

    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ netboot –æ–±—Ä–∞–∑–∞
    NETBOOT_URL="https://deb.debian.org/debian/dists/trixie/main/installer-arm64/current/images/netboot/"
    wget -r -np -nH --cut-dirs=3 -P "$HTTP_DIR" "$NETBOOT_URL"

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx
    cat > /etc/nginx/sites-available/debian-netboot << EOF
server {
    listen 80;
    server_name netboot.local;

    root /var/www/html/tftp;
    index index.html;

    location / {
        try_files \$uri \$uri/ =404;
    }

    # Enable directory listing
    location /debian-installer/ {
        autoindex on;
    }
}
EOF

    ln -sf /etc/nginx/sites-available/debian-netboot /etc/nginx/sites-enabled/

    systemctl reload nginx

    echo "HTTP –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞"
    echo "–î–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://$(hostname -I | awk '{print $1}')/debian-installer/"
}

main() {
    case "$1" in
        "pxe")
            setup_pxe_boot
            ;;
        "http")
            setup_http_boot
            ;;
        *)
            echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 <pxe|http>"
            exit 1
            ;;
    esac
}

main "$@"
```

### –ó–∞–≥—Ä—É–∑–∫–∞ —Å –∂–µ—Å—Ç–∫–æ–≥–æ –¥–∏—Å–∫–∞

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å HDD/SSD –¥–ª—è ARM64:
```bash
#!/bin/bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∂–µ—Å—Ç–∫–æ–≥–æ –¥–∏—Å–∫–∞ –¥–ª—è ARM64

setup_hdd_boot() {
    echo "=== –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å HDD –¥–ª—è ARM64 ==="

    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∏—Å–∫–∞
    TARGET_DISK="${1:-/dev/sda}"

    if [ ! -b "$TARGET_DISK" ]; then
        echo "–û—à–∏–±–∫–∞: –¥–∏—Å–∫ $TARGET_DISK –Ω–µ –Ω–∞–π–¥–µ–Ω"
        exit 1
    fi

    # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤
    parted -s "$TARGET_DISK" mklabel gpt
    parted -s "$TARGET_DISK" mkpart ESP fat32 1MiB 512MiB
    parted -s "$TARGET_DISK" set 1 boot on
    parted -s "$TARGET_DISK" mkpart primary ext4 512MiB 100%

    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    mkfs.fat -F32 "${TARGET_DISK}1"
    mkfs.ext4 "${TARGET_DISK}2"

    # –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    mkdir -p /mnt/debian
    mount "${TARGET_DISK}2" /mnt/debian
    mkdir -p /mnt/debian/boot/efi
    mount "${TARGET_DISK}1" /mnt/debian/boot/efi

    echo "–†–∞–∑–¥–µ–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã"
}

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Debian –Ω–∞ –¥–∏—Å–∫
install_to_disk() {
    echo "=== –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Debian –Ω–∞ –¥–∏—Å–∫ ==="

    TARGET_DISK="${1:-/dev/sda}"

    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ debootstrap –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    apt-get install -y debootstrap

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
    debootstrap --arch=arm64 trixie /mnt/debian http://deb.debian.org/debian/

    # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤
    cp /etc/resolv.conf /mnt/debian/etc/
    cp /etc/hosts /mnt/debian/etc/

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ fstab
    cat > /mnt/debian/etc/fstab << EOF
# /etc/fstab
${TARGET_DISK}2  /       ext4    errors=remount-ro 0       1
${TARGET_DISK}1  /boot/efi vfat    umask=0077      0       1
EOF

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
    chroot /mnt/debian apt-get install -y grub-efi-arm64
    chroot /mnt/debian update-grub

    echo "Debian —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ –¥–∏—Å–∫ $TARGET_DISK"
    echo "–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É —Å —ç—Ç–æ–≥–æ –¥–∏—Å–∫–∞"
}

main() {
    case "$1" in
        "setup")
            shift
            setup_hdd_boot "$@"
            ;;
        "install")
            shift
            install_to_disk "$@"
            ;;
        *)
            echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 <setup|install> [disk]"
            exit 1
            ;;
    esac
}

main "$@"
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ rpi-image-gen

#### –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—è –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏:
```yaml
# METABEGIN
# X-Env-Layer-Name: debian-arm64-boot-methods
# X-Env-Layer-Category: extension
# X-Env-Layer-Description: –ú–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ Debian arm64
# X-Env-Layer-Version: 1.0.0
# X-Env-Layer-Requires: essential
# X-Env-VarPrefix: bootmethod
#
# X-Env-Var-bootmethod_enable_pxe_server: false
# X-Env-Var-bootmethod_enable_pxe_server-Description: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PXE —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–µ—Ç–µ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
# X-Env-Var-bootmethod_enable_pxe_server-Required: false
# X-Env-Var-bootmethod_enable_pxe_server-Valid: true,false
#
# X-Env-Var-bootmethod_enable_http_boot: false
# X-Env-Var-bootmethod_enable_http_boot-Description: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
# X-Env-Var-bootmethod_enable_http_boot-Required: false
# X-Env-Var-bootmethod_enable_http_boot-Valid: true,false
# METAEND
---
mmdebstrap:
  packages:
    - wget
    - curl
  customize-hooks:
    - |
      # –ú–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ Debian arm64
      setup_debian_boot_methods() {
          echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ Debian arm64"

          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PXE —Å–µ—Ä–≤–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
          setup_pxe_server() {
              if [ "${IGconf_bootmethod_bootmethod_enable_pxe_server:-false}" = "true" ]; then
                  echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ PXE —Å–µ—Ä–≤–µ—Ä–∞..."

                  apt-get install -y tftpd-hpa isc-dhcp-server

                  # –°–æ–∑–¥–∞–Ω–∏–µ TFTP –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                  mkdir -p /srv/tftp

                  # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ netboot –æ–±—Ä–∞–∑–∞
                  if [ ! -d /srv/tftp/debian-installer ]; then
                      wget -r -np -nH --cut-dirs=3 \
                          -P /srv/tftp \
                          https://deb.debian.org/debian/dists/trixie/main/installer-arm64/current/images/netboot/
                  fi

                  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DHCP –¥–ª—è PXE
                  cat > /etc/dhcp/dhcpd.conf << EOF
subnet 192.168.1.0 netmask 255.255.255.0 {
    range 192.168.1.100 192.168.1.200;
    option routers 192.168.1.1;
    option domain-name-servers 8.8.8.8;
    filename "debian-installer/arm64/bootnetaa64.efi";
    next-server $(hostname -I | awk '{print $1}');
}
EOF

                  # –í–∫–ª—é—á–µ–Ω–∏–µ —Å–ª—É–∂–±
                  systemctl enable tftpd-hpa
                  systemctl enable isc-dhcp-server
              fi
          }

          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTP boot —Å–µ—Ä–≤–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
          setup_http_boot_server() {
              if [ "${IGconf_bootmethod_bootmethod_enable_http_boot:-false}" = "true" ]; then
                  echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTP boot —Å–µ—Ä–≤–µ—Ä–∞..."

                  apt-get install -y nginx

                  # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –æ–±—Ä–∞–∑–æ–≤
                  mkdir -p /var/www/html/netboot

                  # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
                  if [ ! -d /var/www/html/netboot/debian-installer ]; then
                      wget -r -np -nH --cut-dirs=3 \
                          -P /var/www/html/netboot \
                          https://deb.debian.org/debian/dists/trixie/main/installer-arm64/current/images/netboot/
                  fi

                  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx
                  cat > /etc/nginx/sites-available/netboot << EOF
server {
    listen 80;
    server_name netboot.local;
    root /var/www/html/netboot;

    location / {
        autoindex on;
        try_files \$uri \$uri/ =404;
    }
}
EOF

                  ln -sf /etc/nginx/sites-available/netboot /etc/nginx/sites-enabled/
                  systemctl reload nginx
              fi
          }

          # –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã—Ö –Ω–æ—Å–∏—Ç–µ–ª–µ–π
          create_boot_preparation_script() {
              cat > /usr/local/bin/prepare-boot-media.sh << 'EOF'
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã—Ö –Ω–æ—Å–∏—Ç–µ–ª–µ–π

set -euo pipefail

# –§—É–Ω–∫—Ü–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ USB
prepare_usb() {
    local usb_device="$1"
    local iso_url="$2"

    echo "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ USB $usb_device –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏..."

    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω URL
    if [[ "$iso_url" == http* ]]; then
        echo "–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞..."
        wget -O /tmp/debian-arm64.iso "$iso_url"
        iso_file="/tmp/debian-arm64.iso"
    else
        iso_file="$iso_url"
    fi

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞
    if [ ! -f "$iso_file" ]; then
        echo "–û—à–∏–±–∫–∞: —Ñ–∞–π–ª $iso_file –Ω–µ –Ω–∞–π–¥–µ–Ω"
        exit 1
    fi

    # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
    echo "–í–ù–ò–ú–ê–ù–ò–ï: $usb_device –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω!"
    read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/N): " confirm
    if [[ ! $confirm =~ ^[Yy]$ ]]; then
        exit 0
    fi

    # –†–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    umount "${usb_device}"* 2>/dev/null || true

    # –ó–∞–ø–∏—Å—å –æ–±—Ä–∞–∑–∞
    echo "–ó–∞–ø–∏—Å—å –æ–±—Ä–∞–∑–∞ –Ω–∞ USB..."
    dd if="$iso_file" of="$usb_device" bs=4M status=progress
    sync

    echo "USB $usb_device –≥–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ"
}

# –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ ISO
create_boot_iso() {
    local output_file="$1"

    echo "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ ISO..."

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ genisoimage –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    apt-get install -y genisoimage

    # –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    temp_dir=$(mktemp -d)
    mkdir -p "$temp_dir/efi/boot"

    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ EFI bootloader
    wget -O "$temp_dir/efi/boot/bootaa64.efi" \
        "https://deb.debian.org/debian/dists/trixie/main/installer-arm64/current/images/netboot/debian-installer/arm64/bootaa64.efi"

    # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –º–µ–Ω—é
    cat > "$temp_dir/efi/boot/startup.nsh" << 'EOF'
echo "Debian ARM64 Network Boot"
ifconfig -l
netboot http://192.168.1.1/netboot/debian-installer/arm64/initrd.gz
EOF

    # –°–æ–∑–¥–∞–Ω–∏–µ ISO
    genisoimage -o "$output_file" -V "Debian ARM64 Boot" \
        -e efi/boot/bootaa64.efi -no-emul-boot \
        -J -R "$temp_dir"

    rm -rf "$temp_dir"

    echo "–ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π ISO —Å–æ–∑–¥–∞–Ω: $output_file"
}

case "${1:-help}" in
    "usb")
        prepare_usb "$2" "$3"
        ;;
    "iso")
        create_boot_iso "$2"
        ;;
    "help"|*)
        echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:"
        echo "  $0 usb <device> <iso_file_or_url>"
        echo "  $0 iso <output_file>"
        ;;
esac
EOF

              chmod +x /usr/local/bin/prepare-boot-media.sh
          }

          # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
          setup_pxe_server
          setup_http_boot_server
          create_boot_preparation_script

          echo "–ú–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ Debian arm64 –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
      }

      setup_debian_boot_methods
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- [ ] –ü—Ä–∞–≤–∏–ª–æ –∏–∑—É—á–µ–Ω–æ –∏ –ø–æ–Ω—è—Ç–æ –∫–æ–º–∞–Ω–¥–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [ ] –°–æ–±–ª—é–¥–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤ CI/CD
- [ ] –ù–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –º–µ—Ä–¥–∂–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∞—É–¥–∏—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- [ ] 100% —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ
- [ ] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–µ—Ç–∫–∞—Ö
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [ ] –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –ø—Ä–∞–≤–∏–ª–∞

### –ò—Å—Ç–æ—á–Ω–∏–∫
–°–æ–∑–¥–∞–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–¥–µ–ª–∞ Debian arm64 boot installation methods