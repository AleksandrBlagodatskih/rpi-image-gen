# Enterprise Cockpit конфигурация для управления инфраструктурой
# Полная настройка с мониторингом, безопасностью и enterprise интеграцией

device:
  layer: rpi5
  class: pi5
  variant: 8G
  hostname: enterprise-cockpit-server

image:
  layer: image-rpios
  name: enterprise-cockpit-management
  compression: zstd

layer:
  base: bookworm-minbase
  security: system-monitoring
  monitoring: cockpit

# Enterprise безопасность для Cockpit
security:
  selinux_enabled: y
  apparmor_enabled: y
  auditd_enabled: y
  fail2ban_enabled: y
  ufw_enabled: y

# Enterprise мониторинг для Cockpit
monitoring:
  prometheus_enabled: y
  grafana_enabled: y
  node_exporter: y
  cockpit_metrics: y
  log_aggregation: y

# Cockpit с enterprise настройками
cockpit:
  port: 8443                    # Не стандартный порт для безопасности
  allow_unprivileged: n         # Только привилегированные пользователи
  max_startup_time: 180         # Увеличенное время запуска для enterprise окружения
  login_banner: "Enterprise Infrastructure Management Console - $(hostname) - $(date)"

# Расширенная сеть для enterprise
networking:
  vlan_support: y
  bonding_enabled: y
  firewall_configured: y
  vpn_server: y
  network_monitoring: y

# AppArmor для защиты Cockpit
apparmor:
  enable: y
  mode: enforce
  rpi_optimized: y
  container_support: y
  logging_enable: y

# Firewall с enterprise правилами
ufw:
  enable: y
  default_incoming: deny
  default_outgoing: allow
  allow_services: ssh,8443/tcp
  logging: high
  rate_limiting: y

# Защита от атак на Cockpit
fail2ban:
  enable: y
  backend: systemd
  log_level: WARNING
  default_ban_time: 1h
  default_find_time: 1h
  default_max_retry: 3
  enabled_jails: sshd,dropbear,cockpit
  ignore_ips: 10.0.0.0/8,192.168.0.0/16,172.16.0.0/12

# Аудит доступа к Cockpit
auditd:
  enable: y
  max_log_file: 15
  space_left: 200
  audit_cockpit: y

# Синхронизация времени для логов
time-sync:
  enable: y
  servers:
    - ntp.ubuntu.com
    - time.google.com
    - pool.ntp.org
  timezone: UTC
  max_drift: 50ms

# Автоматические обновления
unattended-upgrades:
  enable: y
  auto_reboot: n
  origins_patterns:
    - origin=Debian,codename=${distro_codename},label=Debian-Security
    - origin=Raspberry Pi Foundation,codename=${distro_codename}
  package_blacklist:
    - cockpit  # Не обновлять Cockpit автоматически для стабильности
