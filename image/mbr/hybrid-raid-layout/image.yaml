# METABEGIN
# X-Env-Layer-Name: hybrid-raid-layout
# X-Env-Layer-Category: image
# X-Env-Layer-Desc: Hybrid SD + RAID1 storage layout with optional LUKS2 encryption (genimage-based disk images). Supports ext4/btrfs/f2fs filesystems with automatic disk expansion.
# X-Env-Layer-Version: 2.1.0
# X-Env-Layer-Requires: raid,luks
# X-Env-Layer-Provides: raid,disk-expansion,luks,encryption,image
#
# X-Env-VarPrefix: hybrid_raid_luks
#
# X-Env-Var-encryption_enabled: n
# X-Env-Var-encryption_enabled-Desc: Enable LUKS2 encryption for root filesystem
# X-Env-Var-encryption_enabled-Required: false
# X-Env-Var-encryption_enabled-Valid: bool
# X-Env-Var-encryption_enabled-Set: immediate
#
# X-Env-Var-rootfs_type: ext4
# X-Env-Var-rootfs_type-Desc: Root filesystem type (ext4, btrfs, f2fs)
# X-Env-Var-rootfs_type-Required: false
# X-Env-Var-rootfs_type-Valid: ext4,btrfs,f2fs
# X-Env-Var-rootfs_type-Set: immediate
#
# X-Env-Var-root_part_size: 2G
# X-Env-Var-root_part_size-Desc: Root partition size
# X-Env-Var-root_part_size-Required: false
# X-Env-Var-root_part_size-Valid: string
# X-Env-Var-root_part_size-Set: immediate
#
# X-Env-Var-boot_part_size: 200M
# X-Env-Var-boot_part_size-Desc: Boot partition size
# X-Env-Var-boot_part_size-Required: false
# X-Env-Var-boot_part_size-Valid: string
# X-Env-Var-boot_part_size-Set: immediate
#
# X-Env-Var-pmap: clear
# X-Env-Var-pmap-Desc: Provisioning Map identifier
# X-Env-Var-pmap-Required: false
# X-Env-Var-pmap-Valid: clear,crypt
# X-Env-Var-pmap-Set: immediate
#
# X-Env-Var-ssd_ids: ata-SAMSUNG_HD204UI_S1XWJ1LZ100000,ata-SAMSUNG_HD204UI_S1XWJ1LZ100001
# X-Env-Var-ssd_ids-Desc: SSD device IDs for stable identification
# X-Env-Var-ssd_ids-Required: false
# X-Env-Var-ssd_ids-Valid: string
# X-Env-Var-ssd_ids-Set: immediate
#
# X-Env-Var-key_method: file
# X-Env-Var-key_method-Desc: LUKS key storage method
# X-Env-Var-key_method-Required: false
# X-Env-Var-key_method-Valid: keywords:file
# X-Env-Var-key_method-Set: immediate
#
# X-Env-Var-key_size: 512
# X-Env-Var-key_size-Desc: LUKS key size in bits
# X-Env-Var-key_size-Required: false
# X-Env-Var-key_size-Valid: int:256-8192
# X-Env-Var-key_size-Set: immediate
#
# X-Env-Var-assetdir: ${DIRECTORY}
# X-Env-Var-assetdir-Desc: Image asset directory for hybrid-raid-layout
# X-Env-Var-assetdir-Required: n
# X-Env-Var-assetdir-Valid: string
# X-Env-Var-assetdir-Set: y
#
# METAEND
---
mmdebstrap:
  packages:
    # RAID1 packages
    - mdadm
    - initramfs-tools
    - parted
    - e2fsprogs  # for resize2fs
    - btrfs-progs  # for btrfs filesystem resize
    - f2fs-tools  # for resize.f2fs
    # LUKS packages
    - cryptsetup

  customize-hooks:
    # RAID configuration hook
    - source: bdebstrap/customize01-raid-setup.sh

    # LUKS configuration hook
    - source: bdebstrap/customize02-luks-setup.sh

    # Disk expansion service setup hook
    - source: bdebstrap/customize03-disk-expansion.sh
