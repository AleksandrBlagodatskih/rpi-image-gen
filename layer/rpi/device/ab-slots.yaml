# METABEGIN
# X-Env-Layer-Name: rpi-ab-slot-mapper
# X-Env-Layer-Category: image
# X-Env-Layer-Desc: Dynamic slot device management for A/B boot: udev rules and
#  helpers that create stable by-slot symlinks from GPT PARTLABELs (preferred)
#  or a static slot map (fallback), with device-mapper and initramfs support.
# X-Env-Layer-Version: 1.0.0
#
# X-Env-VarPrefix: abslot
#
# X-Env-Var-overlay: ${DIRECTORY}/slot-mapper
# X-Env-Var-overlay-Desc: Directory holding filesystem assets installed to
#  support slot management and selection.
# X-Env-Var-overlay-Required: n
# X-Env-Var-overlay-Valid: string
# X-Env-Var-overlay-Set: y
# METAEND
---
mmdebstrap:
  packages:
    - udev
    - initramfs-tools
    - sed
    - coreutils
  customize-hooks:
    - install -D -m 0755 "${IGconf_abslot_overlay}/bin/rpi-slot-label" "$1/usr/bin/rpi-slot-label"
    - install -D -m 0755 "${IGconf_abslot_overlay}/bin/rpi-slot-static" "$1/usr/bin/rpi-slot-static"
    - install -D -m 0755 "${IGconf_abslot_overlay}/bin/rpi-slot-tryboot" "$1/usr/bin/rpi-slot-tryboot"
    - install -D -m 0644 "${IGconf_abslot_overlay}/udev/rules.d/slot.rules" "$1/etc/udev/rules.d/99-rpi-slot.rules"
    - install -D -m 0755 "${IGconf_abslot_overlay}/initramfs-tools/hooks/rpi-ab-install-files" "$1/etc/initramfs-tools/hooks/rpi-ab-install-files"
    - install -D -m 0755 "${IGconf_abslot_overlay}/initramfs-tools/scripts/local-top/rpi-ab-root.sh" "$1/usr/share/initramfs-tools/scripts/local-top/rpi-ab-root.sh"
