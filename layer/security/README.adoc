# Security Layers

## –û–±–∑–æ—Ä

–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `security/` —Å–æ–¥–µ—Ä–∂–∏—Ç enterprise-grade —Å–ª–æ–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ Raspberry Pi. –í—Å–µ —Å–ª–æ–∏ —Å–ª–µ–¥—É—é—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –æ–±—â–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–µ–∑ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.

## –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–ª–æ–∏

#### üîê AppArmor (Mandatory Access Control)
- **–§–∞–π–ª**: `apparmor/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: Mandatory Access Control —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–µ
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ü—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–ª—É–∂–±, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å initramfs –¥–ª—è —Ä–∞–Ω–Ω–µ–π –∑–∞—â–∏—Ç—ã
  - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ CIS benchmarks

#### üîç Auditd (System Logging)
- **–§–∞–π–ª**: `auditd/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - 18+ –±–∞–∑–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  - Compliance –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å (CIS, PCI-DSS, HIPAA, GDPR)
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SIEM —Å–∏—Å—Ç–µ–º–∞–º–∏

#### üö´ Fail2Ban (Intrusion Prevention)
- **–§–∞–π–ª**: `fail2ban/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç brute force –∞—Ç–∞–∫
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SSH, sudo –∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
  - –ö–∞—Å—Ç–æ–º–Ω—ã–µ jail –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–µ
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö IP

#### üîë PAM Hardening (Authentication Policies)
- **–§–∞–π–ª**: `pam-hardening/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –£—Å–∏–ª–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–ª—ã –ø–∞—Ä–æ–ª–µ–π (pwquality)
  - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö (faillock)
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ (limits)

#### üîê Password Policies (Account Security)
- **–§–∞–π–ª**: `password-policies/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª–∏—Ç–∏–∫–∏ —Å—Ç–∞—Ä–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ò—Å—Ç–æ—Ä–∏—è –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

#### üîê Sudo Logging (Privileged Operations Audit)
- **–§–∞–π–ª**: `sudo-logging/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö sudo –∫–æ–º–∞–Ω–¥
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å syslog
  - –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤

#### üîß Sysctl Hardening (System Security)
- **–§–∞–π–ª**: `sysctl-hardening/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ sysctl
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ó–∞—â–∏—Ç–∞ –æ—Ç SYN flood –∞—Ç–∞–∫
  - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ privilege escalation
  - –ó–∞—â–∏—Ç–∞ –æ—Ç IP spoofing

#### ‚è∞ Time Sync (Time Synchronization)
- **–§–∞–π–ª**: `time-sync/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Å –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ systemd-timesyncd, chrony, NTP
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
  - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∞—É–¥–∏—Ç–∞

#### üî• UFW (Firewall)
- **–§–∞–π–ª**: `ufw/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ—Å—Ç–æ–π firewall —Å –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ü–æ–ª–∏—Ç–∏–∫–∞ deny –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤, –ø–æ—Ä—Ç–æ–≤ –∏ IP –∞–¥—Ä–µ—Å–æ–≤
  - IPv6 –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –û–±—â–∏–π —Å–ª–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### üìä System Monitoring (Unified Monitoring)
- **–§–∞–π–ª**: `system-monitoring/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ï–¥–∏–Ω—ã–π —Å–ª–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–µ
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è AppArmor, auditd –∏ Fail2Ban
  - –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ñ–∞–π–ª–æ–≤ –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∞–ª–µ—Ä—Ç–∏–Ω–≥ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

#### ‚è∞ Unattended Upgrades (Automatic Updates)
- **–§–∞–π–ª**: `unattended-upgrades/`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
  - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```yaml
device:
  layer: rpi5

image:
  layer: image-base
  name: secure-system

layer:
  base: bookworm-minbase
  security: apparmor        # Mandatory Access Control
  security: auditd          # System logging
  security: fail2ban        # Intrusion prevention
  security: ufw             # Firewall
  security: time-sync       # Time synchronization
```

### Enterprise –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```yaml
layer:
  base: bookworm-minbase
  security: system-monitoring  # –û–±—â–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
  security: pam-hardening      # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  security: password-policies  # –ü–æ–ª–∏—Ç–∏–∫–∏ –ø–∞—Ä–æ–ª–µ–π
  security: sudo-logging       # –ê—É–¥–∏—Ç sudo
  security: sysctl-hardening   # –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```yaml
layer:
  base: bookworm-minbase
  security: ufw             # –¢–æ–ª—å–∫–æ firewall
  security: time-sync       # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ **–û–±—â–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ—Ç –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- ‚úÖ **CIS Compliance**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Center for Internet Security benchmarks
- ‚úÖ **–†–µ–≥—É–ª—è—Ç–æ—Ä–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ PCI-DSS, HIPAA, GDPR, SOX
- ‚úÖ **Enterprise –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SIEM, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–æ–º

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚ö° **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Raspberry Pi
- ‚ö° **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- ‚ö° **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏—è

## –í–∞–∂–Ω–æ

- –í—Å–µ —Å–ª–æ–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —è–≤–ª—è—é—Ç—Å—è –æ–±—â–∏–º–∏ –∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–µ–≤ –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç—ã
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ staging –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –ø–µ—Ä–µ–¥ production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º
