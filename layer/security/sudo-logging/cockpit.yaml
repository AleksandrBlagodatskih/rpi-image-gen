# METABEGIN
# X-Env-Layer-Name: sudo-logging-cockpit
# X-Env-Layer-Category: extension
# X-Env-Layer-Desc: Sudo logging integration with Cockpit user management
# X-Env-Layer-Version: 2.0.0
# X-Env-Layer-Requires: sudo-logging-core-basic
# X-Env-Layer-Provides: sudo-cockpit-integration
# X-Env-VarPrefix: sudo_logging
# X-Env-Var-cockpit_integration: y
# X-Env-Var-cockpit_integration-Desc: Integrate sudo logging with Cockpit user management
# X-Env-Var-cockpit_integration-Required: false
# X-Env-Var-cockpit_integration-Valid: bool
# X-Env-Var-cockpit_integration-Set: lazy
# METAEND
---
mmdebstrap:
  customize-hooks:
    - |
      # PHASE 0: Enable check
      igconf isy IGconf_sudo_logging_cockpit_integration || exit 0

      echo "üéõÔ∏è Installing sudo Cockpit integration..."

      # Check if Cockpit is available
      if [ ! -f "$1/usr/libexec/cockpit/cockpit-session" ]; then
        echo "‚ö†Ô∏è Cockpit not detected, skipping integration"
        exit 0
      fi

      # Cockpit integration
      echo "üéõÔ∏è Configuring Cockpit sudo integration..."
      # Create cockpit sudo management script
      install -m 644 "templates/security/sudo-logging/sudo-cockpit-manage" "$1/usr/local/bin/sudo-cockpit-manage"
      chmod +x "$1/usr/local/bin/sudo-cockpit-manage"

      # Create cockpit users file
      touch "$1/etc/sudoers.d/cockpit-users"
      chmod 440 "$1/etc/sudoers.d/cockpit-users"

      echo "‚úÖ Cockpit integration configured"
