# METABEGIN
# X-Env-Layer-Name: ufw-distrobox
# X-Env-Layer-Category: extension
# X-Env-Layer-Desc: UFW support for Distrobox container network access
# X-Env-Layer-Version: 2.0.0
# X-Env-Layer-Requires: ufw-core-basic
# X-Env-Layer-Provides: firewall-distrobox-integration
# X-Env-VarPrefix: ufw
# X-Env-Var-distrobox_network: y
# X-Env-Var-distrobox_network-Desc: Allow network access for Distrobox containers
# X-Env-Var-distrobox_network-Required: false
# X-Env-Var-distrobox_network-Valid: bool
# X-Env-Var-distrobox_network-Set: lazy
# METAEND
---
mmdebstrap:
  customize-hooks:
    - |
      # PHASE 0: Enable check
      igconf isy IGconf_ufw_distrobox_network || exit 0

      echo "üì¶ Installing UFW Distrobox integration..."

      # Check if Distrobox is available
      if ! command -v distrobox >/dev/null 2>&1; then
        echo "‚ö†Ô∏è Distrobox not detected, skipping network access"
        exit 0
      fi

      # Distrobox integration
      echo "üì¶ Configuring Distrobox network access..."
      # Create distrobox network rules
      install -m 644 "templates/security/ufw/ufw-distrobox-network" "$1/usr/local/bin/ufw-distrobox-network"
      chmod +x "$1/usr/local/bin/ufw-distrobox-network"

      # Run the configuration
      chroot "$1" /usr/local/bin/ufw-distrobox-network
      echo "‚úÖ Distrobox integration configured"
