# METABEGIN
# X-Env-Layer-Name: ufw-monitoring
# X-Env-Layer-Category: security
# X-Env-Layer-Description: UFW status monitoring and alerting system
# X-Env-Layer-Version: 1.0.0
# X-Env-Layer-Requires: ufw-core
# X-Env-Layer-Provides: firewall-monitoring
# X-Env-VarPrefix: ufw
# X-Env-Var-monitoring: y
# X-Env-Var-monitoring-Description: Enable UFW status monitoring and alerting
# X-Env-Var-monitoring-Required: false
# X-Env-Var-monitoring-Valid: bool
# X-Env-Var-monitoring-Set: lazy
# METAEND
---
mmdebstrap:
  customize-hooks:
    - |
      # PHASE 0: Enable check
      igconf isy IGconf_ufw_monitoring || exit 0

      echo "ðŸ‘ï¸ Installing UFW monitoring..."

      # Monitoring and alerting
      echo "ðŸ‘ï¸ Setting up UFW monitoring..."

      # Create monitoring script
      install -m 644 "templates/security/ufw/ufw-monitor" "$1/usr/local/bin/ufw-monitor"

      chmod +x "$1/usr/local/bin/ufw-monitor"

      # Add to cron for periodic monitoring
      echo "*/30 * * * * root /usr/local/bin/ufw-monitor" >> "$1/etc/crontab"
      echo "âœ… UFW monitoring configured (runs every 30 minutes)"

      # PHASE 2: Status Script
      echo "ðŸ“Š Creating UFW status script..."

      install -m 644 "templates/security/ufw/ufw-security-status" "$1/usr/local/bin/ufw-security-status"

      chmod +x "$1/usr/local/bin/ufw-security-status"

      # Add to PATH
      install -m 644 "templates/security/ufw/ufw-security-status.sh" "$1/etc/profile.d/ufw-security-status.sh"

      echo ""
      echo "âœ… UFW monitoring completed!"
      echo "   Status check: ufw-security-status"
      echo "   View alerts: tail -f /var/log/ufw-alerts.log"
      echo "   Monitor logs: tail -f /var/log/ufw-security.log"
