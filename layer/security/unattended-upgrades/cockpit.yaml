# METABEGIN
# X-Env-Layer-Name: unattended-upgrades-cockpit
# X-Env-Layer-Category: extension
# X-Env-Layer-Desc: Cockpit update notifications for unattended-upgrades
# X-Env-Layer-Version: 2.0.0
# X-Env-Layer-Requires: unattended-upgrades-core-basic
# X-Env-Layer-Provides: package-updates-cockpit-integration
# X-Env-VarPrefix: unattended
# X-Env-Var-cockpit_notification: y
# X-Env-Var-cockpit_notification-Desc: Send update notifications to Cockpit interface
# X-Env-Var-cockpit_notification-Required: false
# X-Env-Var-cockpit_notification-Valid: bool
# X-Env-Var-cockpit_notification-Set: lazy
# METAEND
---
mmdebstrap:
  customize-hooks:
    - |
      # PHASE 0: Enable check
      igconf isy IGconf_unattended_cockpit_notification || exit 0

      echo "üéõÔ∏è Installing unattended-upgrades Cockpit integration..."

      # Check if Cockpit is available
      if [ ! -f "$1/usr/libexec/cockpit/cockpit-session" ]; then
        echo "‚ö†Ô∏è Cockpit not detected, skipping integration"
        exit 0
      fi

      # Cockpit integration
      echo "üéõÔ∏è Adding Cockpit update notifications..."
      # Create cockpit update notification script
      install -m 644 "templates/security/unattended-upgrades/unattended-upgrades-cockpit-notify" "$1/usr/local/bin/unattended-upgrades-cockpit-notify"
      chmod +x "$1/usr/local/bin/unattended-upgrades-cockpit-notify"
      echo "‚úÖ Cockpit integration configured"
