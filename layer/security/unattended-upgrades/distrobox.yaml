# METABEGIN
# X-Env-Layer-Name: unattended-upgrades-distrobox
# X-Env-Layer-Category: extension
# X-Env-Layer-Desc: Distrobox container restart after updates
# X-Env-Layer-Version: 2.0.0
# X-Env-Layer-Requires: unattended-upgrades-core-basic
# X-Env-Layer-Provides: package-updates-distrobox-integration
# X-Env-VarPrefix: unattended
# X-Env-Var-distrobox_restart: y
# X-Env-Var-distrobox_restart-Desc: Restart Distrobox containers after updates if present
# X-Env-Var-distrobox_restart-Required: false
# X-Env-Var-distrobox_restart-Valid: bool
# X-Env-Var-distrobox_restart-Set: lazy
# METAEND
---
mmdebstrap:
  customize-hooks:
    - |
      # PHASE 0: Enable check
      igconf isy IGconf_unattended_distrobox_restart || exit 0

      echo "📦 Installing unattended-upgrades Distrobox integration..."

      # Check if Distrobox is available
      if ! command -v distrobox >/dev/null 2>&1; then
        echo "⚠️ Distrobox not detected, skipping integration"
        exit 0
      fi

      # Distrobox integration
      echo "📦 Adding Distrobox container restart after updates..."
      install -m 644 "templates/security/unattended-upgrades/97unattended-upgrades-distrobox" "$1/etc/apt/apt.conf.d/97unattended-upgrades-distrobox"
      install -m 644 "templates/security/unattended-upgrades/unattended-upgrades-distrobox-restart" "$1/usr/local/bin/unattended-upgrades-distrobox-restart"
      chmod +x "$1/usr/local/bin/unattended-upgrades-distrobox-restart"
      echo "✅ Distrobox integration configured"
