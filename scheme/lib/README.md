# Каталог lib/ - Вспомогательные библиотеки

Каталог содержит библиотеки bash для поддержки основных функций проекта.

## Файлы

### `common.sh`
**Назначение**: Общие функции для всех скриптов
**Основные функции**:
- `msg()` - вывод сообщений
- `warn()`, `err()` - вывод предупреждений и ошибок
- `die()` - завершение с ошибкой
- `run()` - выполнение команд с проверкой
- `rund()` - выполнение команд в указанном каталоге
- `runenv()` - выполнение команд с окружением из файла
- `get_var()` - получение переменных из файлов
- `mapfile_kv()` - обработка key=value файлов
- `runhook()` - выполнение хуков
- `ask()` - интерактивные запросы

### `cli.sh`
**Назначение**: Обработка командной строки
**Функции**:
- `cli_help()` - общая справка
- `cli_parse_build()` - разбор параметров build
- `cli_parse_clean()` - разбор параметров clean
- `cli_parse_layer()` - разбор параметров layer
- `cli_parse_metadata()` - разбор параметров metadata
- `cli_parse_config()` - разбор параметров config
- Валидация путей и файлов

### `dependencies.sh`
**Назначение**: Управление зависимостями
**Функции**:
- `dependencies_check()` - проверка установленных зависимостей
- `dependencies_install()` - установка недостающих пакетов
- Проверка binfmt_misc для кросс-компиляции

## Использование

Библиотеки загружаются в главный скрипт:
```bash
source "$IGTOP/lib/cli.sh"
source "$IGTOP/lib/common.sh"
source "$IGTOP/lib/dependencies.sh"
```

Предоставляют инфраструктуру для:
- Обработки ошибок и сообщений
- Валидации параметров
- Управления зависимостями
- Выполнения команд в контролируемом окружении

## Доступные шаблоны

### `bash-script-template.md`
Шаблон для создания библиотек Bash:
- Структура библиотечных функций
- Экспорт функций
- Проверка загрузки как библиотеки
- Функции логирования и валидации

## Создание новой библиотеки

1. **Создайте файл библиотеки** на основе шаблона:
   ```bash
   cp scheme/lib/bash-script-template.md lib/my-library.sh
   ```
2. **Реализуйте функции** в файле
3. **Экспортируйте функции** для использования в других скриптах:
   ```bash
   export -f function_name
   ```
4. **Добавьте проверку загрузки как библиотеки**:
   ```bash
   if [[ "${BASH_SOURCE[0]}" != "${0}" ]]; then
       return 0
   fi
   ```
