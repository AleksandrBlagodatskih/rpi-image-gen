# Каталог scripts/ - Функциональные хуки

Каталог содержит скрипты, выполняемые на различных этапах сборки.

## Структура каталогов

### `bdebstrap/`
**Назначение**: Скрипты для bdebstrap сборки
**Этапы**:
- `essential01` - базовая настройка
- `customize10-initramfs` - настройка initramfs
- `cleanup01` - очистка

**Использование**:
Скрипты выполняются утилитой `runner` в зависимости от этапа сборки:
```bash
runner setup|extract|essential|customize|cleanup
```

## Назначение

Скрипты предоставляют:
- Кастомную логику на этапах сборки
- Специфичные для устройств настройки
- Дополнительные пакеты и конфигурации
- Чистку временных файлов

Выполняются в изолированном окружении через podman unshare.

## Доступные шаблоны

### `bash-script-template.md` (в lib/)
Шаблон для создания скриптов сборки:
- Структура скриптов для этапов сборки
- Обработка этапов bdebstrap
- Логика кастомизации
- Интеграция с переменными окружения

Используйте: `cp ../lib/bash-script-template.md scripts/my-script.sh`

## Создание нового скрипта сборки

1. **Создайте файл скрипта** на основе шаблона:
   ```bash
   cp ../lib/bash-script-template.md scripts/my-build-script.sh
   chmod +x scripts/my-build-script.sh
   ```
2. **Настройте обработку этапов** в функции main():
   ```bash
   case "${stage}" in
       setup|extract|essential|customize|cleanup)
           # Ваша логика для этапа
           ;;
       *)
           log_error "Неизвестный этап: ${stage}"
           exit 1
           ;;
   esac
   ```
3. **Добавьте скрипт в конфигурацию слоя**:
   ```yaml
   mmdebstrap:
     customize-hooks:
       - my-build-script.sh
   ```
4. **Протестируйте скрипт** в контексте сборки
