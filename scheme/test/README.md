# Каталог test/ - Тесты

Каталог содержит тесты для проверки корректности работы проекта.

## Структура

### `layer/`
**Назначение**: Тесты слоев
**Содержит**:
- `run-tests.sh` - запуск тестов
- `valid-*.yaml` - корректные тестовые слои
- `invalid-*.yaml` - некорректные тестовые слои
- `test-*.yaml` - функциональные тесты
- `env/` - тесты переменных окружения

## Типы тестов

### Валидация
- Синтаксическая корректность YAML
- Корректность метаданных
- Зависимости между слоями
- Переменные окружения

### Функциональность
- Циклические зависимости
- Отсутствующие зависимости
- Неверные типы данных
- Ограничения валидации

### Интеграция
- Взаимодействие между компонентами
- Загрузка конфигурации
- Сборка образов

## Запуск

Тесты запускаются командой:
```bash
./test/layer/run-tests.sh
```

Или через основную систему:
```bash
rpi-image-gen metadata --lint /path/to/layer.yaml
```

## Доступные шаблоны

### `test-template.md`
Шаблон для создания тестов:
- Структура тестового скрипта
- YAML тесты для слоев
- Типы тестирования
- Генерация отчетов

## Создание новых тестов

1. **Создайте тестовый файл** на основе шаблона:
   ```bash
   cp scheme/test/test-template.md test/my-test.sh
   chmod +x test/my-test.sh
   ```
2. **Настройте тип тестирования** (валидация, функциональность, интеграция)
3. **Реализуйте тестовые сценарии**:
   ```bash
   #!/bin/bash
   # Тест валидации
   test_validation() {
       rpi-image-gen metadata --lint layer/test-layer.yaml
   }

   # Тест функциональности
   test_functionality() {
       rpi-image-gen build --dry-run -c test-config.yaml
   }
   ```
4. **Добавьте обработку результатов**:
   ```bash
   if test_validation && test_functionality; then
       echo "Все тесты пройдены"
       exit 0
   else
       echo "Некоторые тесты провалились"
       exit 1
   fi
   ```
5. **Интегрируйте с системой тестирования**
